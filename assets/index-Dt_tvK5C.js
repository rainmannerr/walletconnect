var Vt=Object.defineProperty;var qt=(a,e,t)=>e in a?Vt(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var h=(a,e,t)=>qt(a,typeof e!="symbol"?e+"":e,t);import{I as s,J as X,K as Kt,L as lt,M as zt,N as k,V as ye,O as Yt,P as Qt,Q as Jt,R as Zt,S as Xt,U as ea,W as ta,X as aa,Y as x,_ as b,$,a0 as na,a1 as sa,a2 as de,a3 as ia}from"./vendor-DTwBOZnz.js";import{K as ra,L as oa,M as ee,N as oe,O as ca,P as la,Q as da,R as ua,S as dt,T as pa,V as ha,W as ma,X as ga,Y as fa,Z as ya,_ as xa,$ as ce,a0 as te,a1 as wa,a2 as Ea,a3 as va,a4 as Ca,a5 as Ia,a6 as Sa,a7 as Aa,a8 as ba,a9 as _a,aa as Ra,ab as ja,ac as Ta,ad as Ua,ae as Fa,af as Pa,ag as Da,ah as Na,ai as Oa,aj as Ma,ak as Ha,al as La,am as Ga,an as ka,ao as Ba,ap as Wa,aq as $a,ar as Va,as as qa,at as Ka,au as za,av as Ya,aw as Qa,ax as Ja,ay as Za,az as Xa,aA as en,i as tn,aB as ut,aC as L,I as Q,t as P,p as pt,o as se,m as an,aD as nn,aE as sn,l as rn,aF as on,j as ht,c as Pe,b as cn,aG as mt,aH as gt,aI as ln}from"./viem-CINa55yg.js";import{v as dn,h as un,b as ft,s as pn,y as ze,a as hn,N as J,O as W,T as ue,c as V,S as _}from"./magic-oIL67XHC.js";import{W as yt,a as m,b as ve,U as Me,i as mn,s as gn,c as fn}from"./appkit-BwiGbPsb.js";import{E as xe,a as Z,c as yn,b as xn,p as wn,d as xt,s as En,g as vn,i as wt,e as Et,f as vt,h as Cn}from"./permissionless-D_jMSDQZ.js";import{h as In,e as Sn,a as An,S as He,b as Ct,g as bn,c as _n,d as Rn,f as Ye,i as jn,j as Tn,k as Un,l as Fn}from"./rhinestone-BKmTVzFl.js";(function(){try{var a=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new a.Error().stack;e&&(a._sentryDebugIds=a._sentryDebugIds||{},a._sentryDebugIds[e]="e695e283-2424-48fc-aacc-819085edca59",a._sentryDebugIdIdentifier="sentry-dbid-e695e283-2424-48fc-aacc-819085edca59")}catch{}})();(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(i){if(i.ep)return;i.ep=!0;const r=t(i);fetch(i.href,r)}})();function Pn(){return s.jsxs("div",{children:[s.jsx("h2",{children:"Not Found"}),s.jsx("p",{children:"Could not find requested resource"}),s.jsx("a",{href:"/",children:"Return Home"})]})}const pe=X({frameSdk:void 0}),Le={state:pe,subscribe(a){return Kt(pe,()=>a(pe))},setFrameSdk(a){a&&(pe.frameSdk=lt(a))}},he=X({themeMode:void 0,themeVariables:void 0,w3mThemeVariables:void 0}),It={state:he,setTheme(a){he.themeMode=a.themeMode,he.themeVariables=a.themeVariables,he.w3mThemeVariables=a.w3mThemeVariables}},z=X({verified:void 0,projectId:void 0,sdkVersion:void 0,sdkType:void 0,metadata:void 0}),R={state:z,setDappData(a){z.projectId=a.projectId,z.sdkVersion=a.sdkVersion,z.sdkType=a.sdkType,z.metadata=a.metadata},setProjectId(a){z.projectId=a},setVerified(a){z.verified=a}},Y=X({open:!1,loading:!1}),S={state:Y,open(a){Y.open=!0,Y.event=lt(a)},loading(a=!0){Y.loading=a},close(){Y.open=!1,Y.loading=!1,Y.event=void 0}},St={RESTRICTED_TIMEZONES:["ASIA/SHANGHAI","ASIA/URUMQI","ASIA/CHONGQING","ASIA/HARBIN","ASIA/KASHGAR","ASIA/MACAU","ASIA/HONG_KONG","ASIA/MACAO","ASIA/BEIJING","ASIA/HARBIN"],DEFAULT_SECURE_URL:"https://secure.walletconnect.com/sdk",DEFAULT_RPC_URL:"https://rpc.walletconnect.org",REVEAL_METHOD:{eip155:"recovery-phrase",polkadot:"recovery-phrase",solana:"private-key"}},N={getApiUrl(){return N.isRestrictedRegion()?"https://api.web3modal.org":"https://api.web3modal.com"},isRestrictedRegion(){try{const{timeZone:a}=new Intl.DateTimeFormat().resolvedOptions(),e=a.toUpperCase();return St.RESTRICTED_TIMEZONES.includes(e)}catch{return!1}},createResultUri(a){const e=a.indexOf("?state="),t=a.indexOf("?code=");return e!==-1?a.substring(e):t!==-1?a.substring(t):a},getApiHeaders(a){const e={"x-sdk-type":"w3m","x-sdk-version":"secure-site"};return a&&(e["x-project-id"]=a),e}},we={async get({headers:a,...e}){const t=this.createUrl(e);return(await fetch(t,{method:"GET",headers:a})).json()},async post({headers:a,...e},t){const n=this.createUrl(e);return(await fetch(n,{method:"POST",headers:a,body:JSON.stringify(t)})).json()},async getBlob({headers:a,...e}){const t=this.createUrl(e),n=await fetch(t,{method:"GET",headers:a});if(n.status===200)return n.blob()},createUrl({path:a,params:e}){const t=new URL(a,N.getApiUrl());if(e)for(const[n,i]of Object.entries(e))i&&t.searchParams.append(n,i);return t}},Ge={async fetchNetworkImage(a,e){const t=`${N.getApiUrl()}/public/getAssetImage/${a}`,n=await we.getBlob({path:t,headers:N.getApiHeaders(e)});return n===void 0?void 0:URL.createObjectURL(n)},async fetchWalletImage(a,e){const t=`${N.getApiUrl()}/getWalletImage/${a}`,n=await we.getBlob({path:t,headers:N.getApiHeaders(e)});return n===void 0?void 0:URL.createObjectURL(n)},async fetchWallets(a){const e=`${N.getApiUrl()}/getWallets?page=1&entries=24&chains=eip155:1`,t=await we.get({path:e,headers:N.getApiHeaders(a)}),i=((t==null?void 0:t.data)||[]).map(async({id:o,name:c,homepage:l,image_id:d})=>{const u=await Ge.fetchWalletImage(d,a);return{id:o,name:c,homepage:l,image:u}});return await Promise.all(i)}},At={EIP155NetworkImageIds:{"eip155:1":"692ed6ba-e569-459a-556a-776476829e00","eip155:5":"692ed6ba-e569-459a-556a-776476829e00","eip155:11155111":"692ed6ba-e569-459a-556a-776476829e00","eip155:42161":"600a9a04-c1b9-42ca-6785-9b4b6ff85200","eip155:43114":"30c46e53-e989-45fb-4549-be3bd4eb3b00","eip155:56":"93564157-2e8e-4ce7-81df-b264dbee9b00","eip155:250":"06b26297-fe0c-4733-5d6b-ffa5498aac00","eip155:10":"ab9c186a-c52f-464b-2906-ca59d760a400","eip155:137":"41d04d42-da3b-4453-8506-668cc0727900","eip155:100":"02b53f6a-e3d4-479e-1cb4-21178987d100","eip155:9001":"f926ff41-260d-4028-635e-91913fc28e00","eip155:324":"b310f07f-4ef7-49f3-7073-2a0a39685800","eip155:314":"5a73b3dd-af74-424e-cae0-0de859ee9400","eip155:4689":"34e68754-e536-40da-c153-6ef2e7188a00","eip155:1088":"3897a66d-40b9-4833-162f-a2c90531c900","eip155:1284":"161038da-44ae-4ec7-1208-0ea569454b00","eip155:1285":"f1d73bb6-5450-4e18-38f7-fb6484264a00","eip155:7777777":"845c60df-d429-4991-e687-91ae45791600","eip155:42220":"ab781bbc-ccc6-418d-d32d-789b15da1f00","eip155:8453":"7289c336-3981-4081-c5f4-efc26ac64a00","eip155:84532":"7289c336-3981-4081-c5f4-efc26ac64a00","eip155:1313161554":"3ff73439-a619-4894-9262-4470c773a100","solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp":"a1b58899-f671-4276-6a5e-56ca5bd59700","solana:EtWTRABZaYq6iMfeYKouRu166VU2xqa1":"a1b58899-f671-4276-6a5e-56ca5bd59700","solana:4uhcVJyU9pJkvQyS88uRDiswHXSCkY3z":"a1b58899-f671-4276-6a5e-56ca5bd59700"}},j={getChainNamespace:a=>typeof a=="number"?"eip155":a.split(":")[0],getEvmChainId:a=>typeof a=="number"?a:a.startsWith("eip155:")?Number(a.split(":")[1]):null,getCaipChainId:a=>typeof a=="number"?`eip155:${a}`:a,prepareChainIdResponse:a=>{if(typeof a=="number")return a;const[e,t]=a.split(":");return e==="eip155"?Number(t):a},getChainDataById(a){if(typeof a=="number"||a.startsWith("eip155:")){const e=j.getEvmChainId(a);for(const t of Object.values(ra))if(t.id===e)return t;return}switch(a){case"solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp":return{name:"Solana Mainnet",blockExplorers:{default:{url:"https://explorer.solana.com"}},nativeCurrency:{symbol:"SOL",decimals:9}};case"solana:EtWTRABZaYq6iMfeYKouRu166VU2xqa1":return{name:"Solana Devnet",blockExplorers:{default:{url:"https://explorer.solana.com/?cluster=devnet"}},nativeCurrency:{symbol:"SOL",decimals:9}};case"solana:4uhcVJyU9pJkvQyS88uRDiswHXSCkY3z":return{name:"Solana Testnet",blockExplorers:{default:{url:"https://explorer.solana.com?cluster=testnet"}},nativeCurrency:{symbol:"SOL",decimals:9}};default:return}},createNetwork(a,e){const t=j.getCaipChainId(a);return{chainId:t,rpcUrl:`${St.DEFAULT_RPC_URL}/v1/?chainId=${t}&projectId=${e}`}}},q=X({chainId:1,chainImage:void 0,chainName:"Unknown",symbol:"ETH",decimals:18}),A={state:q,subscribeKey(a,e){return zt(q,a,e)},async setChainId(a){var e,t;q.chainId=a;try{const n=R.state.projectId,i=await Ge.fetchNetworkImage(At.EIP155NetworkImageIds[a??1],n||"");q.chainImage=i;const r=j.getChainDataById(a);q.chainName=(r==null?void 0:r.name)??"Unknown",q.chainExplorerURL=(t=(e=r==null?void 0:r.blockExplorers)==null?void 0:e.default)==null?void 0:t.url,q.symbol=(r==null?void 0:r.nativeCurrency.symbol)||"ETH",q.decimals=(r==null?void 0:r.nativeCurrency.decimals)||18}catch(n){console.error(n)}}};class bt{constructor(e){this.activeChain=e.chain,this.apiKey=e.apiKey,this.projectId=e.projectId,this.instance=this.createInstance(e.chain)}get chain(){return this.activeChain}get magic(){return this.instance}switchChain(e){this.activeChain.chainId!==e.chainId&&(this.instance=this.createInstance(e),this.activeChain=e)}rpcRequest(e){return this.instance.rpcProvider.request(e)}createExtensions(...e){return[new dn,new un,...e]}}class Dn extends bt{createInstance(e){const t=j.getEvmChainId(e.chainId);if(!t)throw new Error("Chain is not an EVM chain");return new ft(this.apiKey,{extensions:this.createExtensions(),network:{rpcUrl:e.rpcUrl,chainId:t},deferPreload:!0,meta:{projectId:this.projectId}})}}class Nn extends bt{createInstance(e){return new ft(this.apiKey,{extensions:this.createExtensions(new pn({rpcUrl:e.rpcUrl})),meta:{projectId:this.projectId}})}rpcRequest(e){switch(e.method){case"solana_signMessage":return this.signMessage(e);case"solana_signTransaction":return this.signTransaction(e);case"solana_signAndSendTransaction":return this.signAndSendTransaction(e);case"solana_signAllTransactions":return this.signAllTransactions(e);default:return super.rpcRequest(e)}}async signMessage(e){const t=k.decode(e.params.message),n=await this.instance.solana.signMessage(t);return{signature:k.encode(n)}}async signTransaction(e){const t=ye.deserialize(k.decode(e.params.transaction)),{rawTransaction:n}=await this.instance.solana.signTransaction(t);return{transaction:k.encode(n)}}async signAndSendTransaction(e){const t=new Yt(this.chain.rpcUrl),n=ye.deserialize(k.decode(e.params.transaction)),i=await t.getLatestBlockhash();n.message.recentBlockhash=i.blockhash;const{rawTransaction:r}=await this.instance.solana.signTransaction(n);return{signature:await t.sendRawTransaction(r,e.params.options)}}async signAllTransactions(e){return{transactions:await Promise.all(e.params.transactions.map(async n=>{const i=ye.deserialize(k.decode(n)),{rawTransaction:r}=await this.instance.solana.signTransaction(i);return k.encode(r)}))}}}class _t{constructor(e){this.chainsMap={},this.apiKey=e.apiKey,this.projectId=e.projectId,this.chain=e.chain,this.activeChain=j.getChainNamespace(this.chain.chainId)}get chainId(){return j.prepareChainIdResponse(this.chain.chainId)}get actor(){if(this.activeChain in this.chainsMap)return this.chainsMap[this.activeChain];switch(this.activeChain){case"eip155":return this.chainsMap.eip155=new Dn({apiKey:this.apiKey,projectId:this.projectId,chain:this.chain}),this.chainsMap.eip155;case"solana":return this.chainsMap.solana=new Nn({apiKey:this.apiKey,projectId:this.projectId,chain:this.chain}),this.chainsMap.solana;default:throw new Error("Chain namespace is not supported")}}switchChain(e){this.activeChain=j.getChainNamespace(e.chainId),this.chain=e,this.actor.switchChain(e)}}const On="pk_live_B080E9DC31E5875E";class Mn{constructor(e,t){h(this,"chainProxy");h(this,"apiKey");h(this,"activeConnectionHandler");h(this,"activeUpdateEmailHandler");h(this,"activeFarcasterConnectionHandler");h(this,"projectId");this.apiKey=On,this.projectId=t;const n=j.createNetwork(e,t);this.chainProxy=new _t({apiKey:this.apiKey,projectId:this.projectId,chain:n}),R.setProjectId(t),A.setChainId(n.chainId)}get magic(){return this.chainProxy.actor.magic}async preload(){await this.magic.preload()}async connectEmail(e,t,n){this.activeConnectionHandler&&(this.activeConnectionHandler.emit(ze.Cancel),this.resetActiveConnectHandler()),this.activeConnectionHandler=this.magic.auth.loginWithEmailOTP({email:e,showUI:!1,deviceCheckUI:!1,overrides:{variation:"AppKit Email OTP"}}),this.activeConnectionHandler.once(hn.DeviceVerificationEmailSent,()=>t({action:"VERIFY_DEVICE"})).once(J.EmailOTPSent,()=>t({action:"VERIFY_OTP"})).once("error",n)}async connectFarcaster(e,t,n){this.activeFarcasterConnectionHandler&&this.resetActiveFarcasterConnectHandler();let i=null;const r=()=>{i&&(clearTimeout(i),i=null);try{this.activeFarcasterConnectionHandler=this.magic.farcaster.login({showUI:!1}),this.activeFarcasterConnectionHandler.on("channel",o=>{e({url:o.url})}).on("success",o=>{t(o)}).on("error",n).on("settled",()=>{this.resetActiveFarcasterConnectHandler()}).on("done",()=>{this.resetActiveFarcasterConnectHandler()})}catch(o){o instanceof Error&&o.message==="Channel not created yet."&&(i=setTimeout(r,1e3))}};r()}async connectEmailDevice(e,t){this.activeConnectionHandler&&this.activeConnectionHandler.once(J.EmailOTPSent,e).once("error",t)}async getSocialRedirectUri(e){const t=e==="x"?"twitter":e;return await this.magic.oauth2.loginWithRedirect({provider:t,redirectURI:new URL("/sdk/oauth",window.location.origin).href,shouldReturnURI:!0})}async connectSocial(e){try{return await this.magic.oauth2.getRedirectResult(e)}catch(t){throw new Error(String(t))}}async connectEmailOtp(e,t,n){if(this.activeConnectionHandler){const i=()=>{t(),o()},r=u=>{n(new Error(u)),o()},o=()=>{this.activeConnectionHandler&&(this.activeConnectionHandler.removeListener("done",i),this.activeConnectionHandler.removeListener("error",d),this.activeConnectionHandler.removeListener(J.ExpiredEmailOtp,l),this.activeConnectionHandler.removeListener(J.InvalidEmailOtp,c),this.activeConnectionHandler.removeListener("settled",this.resetActiveConnectHandler))},c=()=>r("Invalid code"),l=()=>r("Invalid code"),d=u=>r(u.message);this.activeConnectionHandler.once("done",i).once("error",d).once(J.ExpiredEmailOtp,l).once(J.InvalidEmailOtp,c).once("settled",this.resetActiveConnectHandler),this.activeConnectionHandler.emit(ze.VerifyEmailOtp,e)}}async getUser(){const{email:e,publicAddress:t}=await this.magic.user.getInfo();if(!e&&!t)throw new Error("FrameSdk: getUser() no user data");return{email:e,address:t,chainId:this.chainProxy.chainId}}async getChainId(){return this.chainProxy.chainId}async signOut(){this.activeUpdateEmailHandler&&(this.activeUpdateEmailHandler.emit(W.Cancel),this.activeUpdateEmailHandler.emit(ue.Cancel),this.resetActiveUpdateEmailHandler()),await this.magic.user.logout()}async switchNetwork(e){this.chainProxy.switchChain(e),A.setChainId(e.chainId)}async isConnected(){return await this.magic.user.isLoggedIn()}async rpcRequest(e){switch(e.method){case"wallet_getCapabilities":return{};case"wallet_sendCalls":case"wallet_getCallsStatus":throw new Error("Method not supported");default:return this.chainProxy.actor.rpcRequest(e)}}async updateEmail(e,t,n){this.activeUpdateEmailHandler&&(this.activeUpdateEmailHandler.emit(W.Cancel),this.activeUpdateEmailHandler.emit(ue.Cancel),this.resetActiveUpdateEmailHandler());const i=()=>{t({action:"VERIFY_PRIMARY_OTP"}),f()},r=()=>{t({action:"VERIFY_SECONDARY_OTP"}),f()},o=()=>{var p;u("New Email Not Valid"),(p=this.activeUpdateEmailHandler)==null||p.emit(W.Cancel)},c=()=>{var p;u("Email Not Deliverable"),(p=this.activeUpdateEmailHandler)==null||p.emit(ue.Cancel)},l=()=>{var p;u("New Email Not Deliverable"),(p=this.activeUpdateEmailHandler)==null||p.emit(W.Cancel)},d=()=>{var p;u("New Email Already Exists"),(p=this.activeUpdateEmailHandler)==null||p.emit(W.Cancel)},u=p=>{n(new Error(p)),f()},f=()=>{this.activeUpdateEmailHandler&&(this.activeUpdateEmailHandler.removeListener(V.EmailSent,i),this.activeUpdateEmailHandler.removeListener(_.EmailSent,r),this.activeUpdateEmailHandler.removeListener(V.EmailNotDeliverable,c),this.activeUpdateEmailHandler.removeListener(_.EmailAlreadyExists,d),this.activeUpdateEmailHandler.removeListener(_.InvalidEmail,o),this.activeUpdateEmailHandler.removeListener(_.EmailNotDeliverable,l),this.activeUpdateEmailHandler.removeListener("error",u))};this.activeUpdateEmailHandler=this.magic.auth.updateEmailWithUI({email:e,showUI:!1}),this.activeUpdateEmailHandler.once(V.EmailSent,i),this.activeUpdateEmailHandler.once(V.EmailNotDeliverable,c),this.activeUpdateEmailHandler.once(_.EmailSent,r),this.activeUpdateEmailHandler.once(_.EmailAlreadyExists,d),this.activeUpdateEmailHandler.once(_.InvalidEmail,o),this.activeUpdateEmailHandler.once(_.EmailNotDeliverable,l),this.activeUpdateEmailHandler.once("error",p=>u(p.message))}async updateEmailPrimaryOtp(e,t,n){if(this.activeUpdateEmailHandler){const i=y=>{n(new Error(y)),p()},r=()=>{t(),p()},o=()=>{i("Invalid Otp")},c=()=>{var y;i("New Email Not Valid"),(y=this.activeUpdateEmailHandler)==null||y.emit(W.Cancel)},l=()=>{var y;i("New Email Not Deliverable"),(y=this.activeUpdateEmailHandler)==null||y.emit(W.Cancel)},d=()=>{var y;i("New Email Already Exists"),(y=this.activeUpdateEmailHandler)==null||y.emit(W.Cancel)},u=()=>{i("Otp Expired")},f=y=>i(y.message),p=()=>{this.activeUpdateEmailHandler&&(this.activeUpdateEmailHandler.removeListener(_.EmailSent,r),this.activeUpdateEmailHandler.removeListener(V.InvalidEmailOtp,o),this.activeUpdateEmailHandler.removeListener(_.InvalidEmail,c),this.activeUpdateEmailHandler.removeListener(_.EmailNotDeliverable,l),this.activeUpdateEmailHandler.removeListener(_.EmailAlreadyExists,d),this.activeUpdateEmailHandler.removeListener(V.EmailExpired,u),this.activeUpdateEmailHandler.removeListener("error",f))};this.activeUpdateEmailHandler.once(_.EmailSent,r),this.activeUpdateEmailHandler.once(V.InvalidEmailOtp,o),this.activeUpdateEmailHandler.once(_.InvalidEmail,c),this.activeUpdateEmailHandler.once(_.EmailNotDeliverable,l),this.activeUpdateEmailHandler.once(_.EmailAlreadyExists,d),this.activeUpdateEmailHandler.once(V.EmailExpired,u),this.activeUpdateEmailHandler.once("error",f),this.activeUpdateEmailHandler.emit(ue.VerifyEmailOtp,e)}}async updateEmailSecondaryOtp(e,t,n){if(this.activeUpdateEmailHandler){const i=u=>{n(new Error(u)),d()},r=async()=>{await this.activeConnectionHandler;const{email:u}=await this.getUser();t({newEmail:u}),d()},o=()=>{i("Invalid Otp")},c=()=>{i("Otp Expired")},l=u=>i(u.message),d=()=>{this.activeUpdateEmailHandler&&(this.activeUpdateEmailHandler.removeListener(_.InvalidEmailOtp,o),this.activeUpdateEmailHandler.removeListener(_.EmailExpired,c),this.activeUpdateEmailHandler.removeListener("error",l),this.activeUpdateEmailHandler.removeListener(_.EmailUpdated,r))};this.activeUpdateEmailHandler.once(_.EmailUpdated,r),this.activeUpdateEmailHandler.once(_.InvalidEmailOtp,o),this.activeUpdateEmailHandler.once(_.EmailExpired,c),this.activeUpdateEmailHandler.once("error",l),this.activeUpdateEmailHandler.emit(W.VerifyEmailOtp,e)}}async getProvider(){return await this.magic.wallet.getProvider()}resetActiveConnectHandler(){var e;(e=this.activeConnectionHandler)==null||e.removeAllListeners(),this.activeConnectionHandler=void 0}resetActiveUpdateEmailHandler(){var e;(e=this.activeUpdateEmailHandler)==null||e.removeAllListeners(),this.activeUpdateEmailHandler=void 0}resetActiveFarcasterConnectHandler(){var e;(e=this.activeFarcasterConnectionHandler)==null||e.removeAllListeners(),this.activeFarcasterConnectionHandler=void 0}}const F={parseMagicError(a){const e=/Magic RPC Error: \[(-?\d+)\] (.*)/,t=a.message.match(e);if(t){const n=t[2];return{...a,message:n||a.message}}return a}},Hn="shortSession",Ln={isShortSession(){var a;return typeof document>"u"?!1:((a=document.cookie.split("; ").find(e=>e.startsWith(`${Hn}=`)))==null?void 0:a.split("=")[1])==="true"},clearLocalStorage(){typeof window>"u"||(window.localStorage.clear(),window.sessionStorage.clear(),window.indexedDB.databases().then(a=>{a.forEach(e=>{e.name&&window.indexedDB.deleteDatabase(e.name)})}))}},Ee="w3m-frame-store";async function je(){return Qt("w3m-frame",1,{upgrade(a){a.createObjectStore(Ee)}})}const Qe={async setIDb(a,e){(await je()).put(Ee,e,a)},async getIDb(a){return(await je()).get(Ee,a)},async deleteIDb(a){(await je()).delete(Ee,a)},async setPreferredAccount(a,e){const t=await this.getIDb("preferredAccounts");await this.setIDb("preferredAccounts",{...t,[a]:e})},async getPreferredAccount(a){const e=await this.getIDb("preferredAccounts");return e==null?void 0:e[a]}},ke=[oa,ee,oe,ca,la,da,ua,dt,pa,ha,ma,ga,fa,ya,xa,ce,te,wa,Ea,va,Ca,Ia,Sa,Aa,ba,_a,Ra,ja,Ta,Ua,Fa,Pa,Da,Na,Oa,Ma,Ha,La,Ga,ka,Ba,Wa,$a,Va,qa,Ka,za,Ya,Qa,Ja,Za,Xa,en],Gn=[ce,oe],kn=[ce,oe],le=a=>a.reduce((e,t)=>(e[t.id]=t,e),{}),Rt=[ee,te],Bn=[ee,te],ie=le(ke),Wn=le(Gn),$n=le(kn),Vn=le(Rt),qn=le(Bn),Je="1.4.1",Kn="zg3ijy0p46",Ze=BigInt(+`0x${Buffer.from(Kn).toString("hex")}`),D={eth_personalSign:0,eth_signTypedData_v4:1,eth_sendTransaction:0,wallet_sendCalls:0,wallet_getCallsStatus:0,wallet_grantPermissions:0,wallet_revokePermissions:0},Ce=344,zn=BigInt("0x6335a9826b53f99a"),jt={async get({headers:a,...e}){const t=this.createUrl(e);return(await fetch(t,{method:"GET",headers:a})).json()},async post({headers:a,...e},t){const n=this.createUrl(e);return(await fetch(n,{method:"POST",headers:a,body:JSON.stringify(t)})).json()},async getBlob({headers:a,...e}){const t=this.createUrl(e),n=await fetch(t,{method:"GET",headers:a});if(n.status===200)return n.blob()},createUrl({path:a,params:e,chainId:t}){const n=new URLSearchParams(location.search).get("projectId"),i=`${Be}/v1`,r={chainId:t??String(A.state.chainId),projectId:n,...e},o=new URL(a,i);for(const[c,l]of Object.entries(r))l&&o.searchParams.append(c,l);return o}},Tt=[{constant:!0,inputs:[],name:"name",outputs:[{name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"_spender",type:"address"},{name:"_value",type:"uint256"}],name:"approve",outputs:[{name:"success",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"totalSupply",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"_from",type:"address"},{name:"_to",type:"address"},{name:"_value",type:"uint256"}],name:"transferFrom",outputs:[{name:"success",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"decimals",outputs:[{name:"",type:"uint8"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"_value",type:"uint256"}],name:"burn",outputs:[{name:"success",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"",type:"address"}],name:"balanceOf",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"_from",type:"address"},{name:"_value",type:"uint256"}],name:"burnFrom",outputs:[{name:"success",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"symbol",outputs:[{name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"_to",type:"address"},{name:"_value",type:"uint256"}],name:"transfer",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"_spender",type:"address"},{name:"_value",type:"uint256"},{name:"_extraData",type:"bytes"}],name:"approveAndCall",outputs:[{name:"success",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"",type:"address"},{name:"",type:"address"}],name:"allowance",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{inputs:[{name:"initialSupply",type:"uint256"},{name:"tokenName",type:"string"},{name:"tokenSymbol",type:"string"}],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,name:"from",type:"address"},{indexed:!0,name:"to",type:"address"},{indexed:!1,name:"value",type:"uint256"}],name:"Transfer",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"from",type:"address"},{indexed:!1,name:"value",type:"uint256"}],name:"Burn",type:"event"}],Yn=N.getApiUrl(),Xe={8453:{USDC:"0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913"},42161:{USDC:"0x2791bca1f2de4661ed88a30c99a7a9449aa84174"}},me=a=>{var e,t,n,i,r,o;return{...a,preVerificationGas:(e=a.preVerificationGas)==null?void 0:e.toString(),verificationGasLimit:(t=a.verificationGasLimit)==null?void 0:t.toString(),callGasLimit:(n=a.callGasLimit)==null?void 0:n.toString(),maxFeePerGas:(i=a.maxFeePerGas)==null?void 0:i.toString(),maxPriorityFeePerGas:(r=a.maxPriorityFeePerGas)==null?void 0:r.toString(),nonce:(o=a.nonce)==null?void 0:o.toString(),paymasterAndData:"0x"}},G=X({availableGasPaymentTokens:[],quotes:[],balances:[]}),U={state:G,async fetchApi({endpoint:a,body:e,projectId:t}){return we.post({path:`${Yn}/smart-accounts/v1/${a}`,headers:N.getApiHeaders(t)},e)},async sponsorDeployTransaction(a,e,t){if(!Ie(e.id))throw new Error("Chain not supported");const i=await U.fetchApi({endpoint:"sponsor-user-operation",body:{userOperation:me(a),chain:e.id},projectId:t});return{...a,paymasterAndData:i.paymasterAndData,preVerificationGas:i.preVerificationGas?BigInt(i.preVerificationGas):a.preVerificationGas,verificationGasLimit:i.verificationGasLimit?BigInt(i.verificationGasLimit):a.verificationGasLimit,callGasLimit:i.callGasLimit?BigInt(i.callGasLimit):a.callGasLimit}},async buildTokenApprovalTransaction(a){const e=a.feeQuote.tokenAddress,t=a.spender;let n=BigInt(0);a.maxApproval?n=BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"):n=BigInt(Math.ceil(a.feeQuote.maxGasFee*10**a.feeQuote.decimal));const i=tn({abi:Tt,functionName:"approve",args:[t,n]});return{to:e,value:0n,data:i}},async sponsorUserOperationWithERC20(a,e,t,n,i){var w;if(!Xe[e.id][t])throw new Error("Token not supported on this chain");const c=await U.fetchApi({endpoint:"get-erc-20-fee-quote",body:{userOperation:me(a),chain:e.id,token:t},projectId:n}),l=c.paymasterAddress,d=c.feeQuotes.find(I=>I.symbol===t);if(!d)return a;const u=await U.buildTokenApprovalTransaction({feeQuote:d,spender:l,maxApproval:!0});if(u.data==="0x"||u.to==="0x0000000000000000000000000000000000000000")return a;const{callData:f}=await i.getBatchedUserOperation({calls:[u,((w=S.state.event)==null?void 0:w.payload).params[D.eth_sendTransaction]]}),p={...a,callData:f},y=await U.fetchApi({endpoint:"sponsor-user-operation",body:{userOperation:me(p),chain:e.id,token:t,mode:"ERC20"},projectId:n});return{...y,paymasterAndData:y.paymasterAndData,preVerificationGas:BigInt(y.preVerificationGas),verificationGasLimit:BigInt(y.verificationGasLimit),callGasLimit:BigInt(y.callGasLimit),maxPriorityFeePerGas:BigInt(y.maxPriorityFeePerGas),maxFeePerGas:BigInt(y.maxFeePerGas)}},async getERC20GasQuotes(a,e,t,n){if(n&&!Xe[e.id][n])throw new Error("Token not supported on this chain");const i=await U.fetchApi({endpoint:"get-erc-20-fee-quote",body:{userOperation:me(a),chain:e.id,token:n},projectId:t});return G.quotes=i.feeQuotes,i.feeQuotes},async getBalance(a,e){const t=R.state.projectId||"",n=N.getApiHeaders(),i=await jt.get({path:`/v1/account/${a}/balance`,headers:n,params:{currency:"usd",projectId:t,chainId:e}});return G.balances=i.balances,i},async getAvailableGasPaymentTokens(){const a=G.quotes.map(i=>i.symbol),e=G.balances.filter(i=>a.includes(i.symbol));G.availableGasPaymentTokens=e.reduce((i,r)=>{const o=G.quotes.find(c=>c.symbol===r.symbol);return o&&i.push({...r,quote:o}),i},[]);const t=G.balances.find(i=>i.symbol===A.state.symbol),n=t?{...t,quote:null}:{name:A.state.chainName||"Ethereum",symbol:A.state.symbol||"ETH",chainId:A.state.chainId.toString()||"1",price:1,quantity:{decimals:A.state.decimals.toString(),numeric:"0"},iconUrl:A.state.chainImage||"",quote:null};n&&G.availableGasPaymentTokens.push(n)}};A.subscribeKey("symbol",a=>{G.paymentToken=a});const Ut="7fcebd0d-53e8-411c-9c88-5af50c9959bf",Qn="getty@gfxlabs.io,eddy@gfxlabs.io,ev+smart-sessions@trifle.life,garvitdelhi@gmail.com,greg@chainsafe.io,karandeep@reown.com".split(",")||[],ge=a=>{const e=j.getEvmChainId(a);return e?e in ie:!1},et=(a,e)=>{var l,d;const n=((l=(a||"sdk-type-0.0.0").split("-"))==null?void 0:l[2])||"0.0.0",i=((d=n==null?void 0:n.split("."))==null?void 0:d[0])||0,r=Number(i)>=5;return a==="secure-site"||e==="appkit"||r},Ie=a=>Wn[a]??null,Se=a=>$n[a]??null,Jn=a=>Vn[a]??null,Ft=a=>!!qn[a],Be="https://rpc.walletconnect.org",Zn=({chain:a})=>`https://api.pimlico.io/v2/${a.id}/rpc?apikey=${Ut}`,Ae=({chain:a})=>`https://api.pimlico.io/v1/${a.id}/rpc?apikey=${Ut}`,Re=({chain:a,projectId:e})=>`${Be}/v1?chainId=eip155:${a.id}&projectId=${e}`,Pt=({chain:a,projectId:e})=>ut({chain:a,transport:L(Re({chain:a,projectId:e}))}),tt={SAFE_ERC_7579_LAUNCHPAD_ADDRESS:"0xEBe001b3D534B9B6E2500FB78E67a1A137f561CE",SAFE_4337_MODULE_ADDRESS:"0x3Fdb5BC686e861480ef99A6E3FaAe03c0b9F32e2"},Xn=(a,e)=>{if(a==="v0.7"){if(!Ft(e))throw new Error(`Safe Entrypoint V7 not supported for chain ${e}`);return{safeVersion:Je,saltNonce:Ze,entryPoint:xe,safe4337ModuleAddress:tt.SAFE_4337_MODULE_ADDRESS,erc7579LaunchpadAddress:tt.SAFE_ERC_7579_LAUNCHPAD_ADDRESS}}return{safeVersion:Je,entryPoint:Z,saltNonce:Ze}},Dt=[ce.id,oe.id],es=async({chainId:a,userOp:e,projectId:t})=>{if(!Dt.includes(a))return!1;try{const i=Pt({chain:j.getChainDataById(a),projectId:t}),{maxFeePerGas:r,maxPriorityFeePerGas:o}=await i.estimateFeesPerGas();return(await U.sponsorDeployTransaction({...e,maxFeePerGas:(e==null?void 0:e.maxFeePerGas)||r,maxPriorityFeePerGas:(e==null?void 0:e.maxPriorityFeePerGas)||o,nonce:e==null?void 0:e.nonce,paymasterAndData:"0x"},Ie(a),t)).paymasterAndData!=="0x"}catch{return!1}},ts=(a,e)=>e&&(e.includes("+smart-sessions@reown.com")||Qn.includes(e))&&Ft(a.id);var M=(a=>(a.eoa="eoa",a.smartAccount="smartAccount",a))(M||{});class re{constructor({provider:e,entryPoint:t,account:n,chain:i,projectId:r,testSponsor:o=!1}){h(this,"isDeployed");h(this,"chain");h(this,"address");h(this,"testSponsor",!1);h(this,"entryPoint");h(this,"publicClient");h(this,"paymasterClient");h(this,"smartAccountClient");h(this,"provider");h(this,"account");h(this,"projectId");h(this,"getNonce",async()=>vn(this.publicClient,{sender:this.account.address,entryPoint:this.entryPoint,key:zn}));h(this,"checkForDeployment",async()=>{try{const e=await wt(this.publicClient,this.account.address);return this.isDeployed=e,e}catch{return}});h(this,"signMessage",async e=>{const t=Q(e,"string");return this.smartAccountClient.signMessage({message:t,account:this.account})});h(this,"sendTransaction",async({to:e,value:t,data:n})=>this.smartAccountClient.sendTransaction({to:e,value:t,data:n,chain:this.chain,account:this.account,nonce:Number(await this.getNonce())}));h(this,"_signTypedData",async({domain:e,types:t,primaryType:n,message:i})=>this.smartAccountClient.signTypedData({account:this.account,domain:e,types:t,primaryType:n,message:i}));h(this,"signTransaction",async e=>this.account.signTransaction(e)||"");h(this,"encodeTransactionToPartialUserOp",async({to:e,value:t,data:n})=>{const i=await this.account.encodeCallData({to:e,value:t||BigInt(0),data:n||"0x"});return{sender:this.account.address,callData:i||"0x",nonce:await this.getNonce(),initCode:await this.account.getInitCode(),paymasterAndData:"0x",signature:"0x"}});h(this,"isDeploymentSponsored",()=>!!Dt.includes(this.chain.id));h(this,"getDeploymentCost",async()=>{const e=await this.publicClient.getGasPrice(),t=Ce/2,n=21e3,i=t*200,r=n+i;return BigInt(r)*e});if(!r)throw new Error("A project ID is required");this.provider=e,this.projectId=r,this.chain=i,this.testSponsor=o,this.account=n,this.address=n.address,this.entryPoint=t,this.publicClient=Pt({chain:i,projectId:r}),this.paymasterClient=yn({transport:L(Zn({chain:this.chain,projectId:r})),entryPoint:this.entryPoint});const c=this.getClientConfig();this.smartAccountClient=xn({...c,account:this.account}).extend(wn(this.entryPoint))}}h(re,"getAccountFromProvider",async({provider:e,chain:t,projectId:n,entryPointVersion:i})=>{const r=await xt(e),o=ut({transport:L(Re({chain:t,projectId:n}))}),c=Xn(i,t.id);return await En(o,{...c,signer:r})});const Nt={[te.id]:"0x9A6c4974dcE237E01Ff35c602CA9555a3c0Fa5EF",[ee.id]:"0x6E1FCe0ec6feaD8dBD2D36a5b9eCf8e33A538479"},as={[te.id]:"0xcaF0461410340F8F366f1F7F7716cF1D90b6bdA4",[ee.id]:"0x3cA2D7D588FA66248a49c1C885997e5017aF9Dc7"};te.id+"",ee.id+"";const at="0xA4C777199658a41688E9488c4EcbD7a2925Cc23A";var De=(a=>(a[a.SECP256K1=0]="SECP256K1",a[a.SECP256R1=1]="SECP256R1",a))(De||{});const O={CHAIN_UNDEFINED:"getContext: chain is undefined",MISMATCHED_CHAIN_ID:"getContext: chain mismatch",ACCOUNT_UNDEFINED:"getContext: Wallet account is undefined",CONTRACT_ADDRESS_UNDEFINED:"Contract address is undefined",FUNCTIONS_UNDEFINED:"Functions is undefined",UNSUPPORTED_SIGNER_TYPE:"Unsupported signer type",INVALID_SIGNATURE:"Invalid signature",FUNCTION_ABI_NOT_FOUND:a=>`Function ABI not found for function: ${a}`,UNSUPPORTED_KEY_TYPE:a=>`Unsupported key type: ${a}`,UNSUPPORTED_PERMISSION_TYPE:a=>`Unsupported permission type: ${a}. Only 'contract-call' is allowed.`},ns=P(pt("1",{size:32}));function ss(a,e,t,n){return{chainId:BigInt(a),session:{...e,account:t,smartSession:Ct,mode:parseInt(He.ENABLE,16),nonce:n}}}async function is(a,e,t){const n=await bn({session:t}),i=await _n({client:a,account:e,permissionId:n}),r=await Rn({client:a,account:e,session:t,mode:He.ENABLE,permissionId:n});return{sessionNonce:i,sessionDigest:r,permissionId:n}}async function rs(a,e,{account:t,grantPermissionsRequest:n}){if(!e.account)throw new Error(O.ACCOUNT_UNDEFINED);const{chainId:i}=n;if(!e.chain||!a.chain||!i)throw new Error(O.CHAIN_UNDEFINED);if(P(e.chain.id)!==i||P(a.chain.id)!==i)throw new Error(O.MISMATCHED_CHAIN_ID);const r=cs(n),{sessionNonce:o,sessionDigest:c,permissionId:l}=await is(a,t,r),d=ss(e.chain.id,r,t.address,o),u=In([d]),f=Sn({account:t,chainId:e.chain.id,validator:t.address,hash:u});if(!e.account)throw new Error(O.ACCOUNT_UNDEFINED);const p=await e.signMessage({account:e.account,message:{raw:pt(f)}}),y=os("eth_sign",p),E=An({mode:He.ENABLE,permissionId:l,signature:"0x",enableSessionData:{enableSession:{chainDigestIndex:0,hashesAndChainIds:[{chainId:BigInt(e.chain.id),sessionDigest:c}],sessionToEnable:r,permissionEnableSig:y},validator:t.address,accountType:t.type}});return se(["address","bytes"],[Ct,E])}const os=(a,e)=>{const t=[0,1,27,28],n=27;let i=Number.parseInt(e.slice(-2),16);if(!t.includes(i))throw new Error(O.INVALID_SIGNATURE);return i<n&&(i+=n),i+=4,e.slice(0,-2)+i.toString(16)};function cs({chainId:a,expiry:e,permissions:t,signer:n}){const i=parseInt(a,16),r=fs(t,i,e),o=ds(n,i),c=us(n);return{chainId:BigInt(i),sessionValidator:o,sessionValidatorInitData:c,salt:ns,userOpPolicies:[],actions:r,erc7739Policies:{allowedERC7739Content:[],erc1271Policies:[]}}}function Ot(a){return a.type==="keys"}function ls(a){return a.data.keys.map(e=>{switch(e.type.toLowerCase()){case"secp256k1":return{type:De.SECP256K1,data:on(e.publicKey)};case"secp256r1":const{x:t,y:n}=Jt(e.publicKey);return{type:De.SECP256R1,data:rn([{type:"uint256"},{type:"uint256"}],[t,n])};default:throw new Error(O.UNSUPPORTED_KEY_TYPE(e.type))}})}function ds(a,e){if(Ot(a))return as[e];throw new Error(O.UNSUPPORTED_SIGNER_TYPE)}function us(a){if(Ot(a)){const e=ls(a);return ps(e)}throw new Error(O.UNSUPPORTED_SIGNER_TYPE)}function ps(a){return a.reduce((e,t)=>an([e,se(["uint8","bytes"],[t.type,t.data])]),se(["uint8"],[a.length]))}function hs(a){return a.type==="contract-call"}function ms(a){return a.type==="native-token-recurring-allowance"}function gs(a){return a.type==="erc20-recurring-allowance"}function fs(a,e,t){return a.reduce((n,i)=>{switch(!0){case hs(i):n.push(...ys(i,e,t));break;case ms(i):case gs(i):n.push(...xs(i,e,t));break;default:throw new Error(O.UNSUPPORTED_PERMISSION_TYPE(JSON.stringify(i)))}return n},[])}function ys(a,e,t){if(!a.data.address)throw new Error(O.CONTRACT_ADDRESS_UNDEFINED);if(!a.data.functions||a.data.functions.length===0)throw new Error(O.FUNCTIONS_UNDEFINED);return a.data.functions.map(n=>{const i=n.functionName,r=a.data.abi,o=nn({abi:r,name:i});if(!o||o.type!=="function")throw new Error(O.FUNCTION_ABI_NOT_FOUND(i));const c=sn(o);return{actionTarget:a.data.address,actionTargetSelector:c,actionPolicies:[{policy:Nt[e],initData:se(["uint128","uint128"],[BigInt(t),BigInt(0)])}]}})}function xs(a,e,t){return[{actionTarget:"0x0000000000000000000000000000000000000001",actionTargetSelector:"0x00000001",actionPolicies:[{policy:Nt[e],initData:se(["uint128","uint128"],[BigInt(t),BigInt(0)])}]}]}const be=class be extends re{constructor({provider:t,account:n,chain:i,projectId:r,testSponsor:o=!1}){super({provider:t,entryPoint:xe,account:n,chain:i,projectId:r,testSponsor:o});h(this,"bundlerClient");h(this,"sponsorUserOperation",async t=>{if(this.testSponsor){const i=await this.paymasterClient.sponsorUserOperation(t);return{...t.userOperation,...i}}try{if(t.paymasterUrl){const n=ht({chain:this.chain,transport:L(t.paymasterUrl)}).extend(vt(xe)),i=await n.getPaymasterStubData({userOperation:t.userOperation,context:t.paymasterContext}),r=await this.bundlerClient.estimateUserOperationGas({userOperation:{...t.userOperation,...i}}),{paymaster:o,paymasterData:c}=await n.getPaymasterData({userOperation:{...t.userOperation,...r,...i,paymasterVerificationGasLimit:r.paymasterVerificationGasLimit||0n,paymasterPostOpGasLimit:r.paymasterPostOpGasLimit||0n},context:t.paymasterContext});return{...t.userOperation,...r,paymaster:o,paymasterData:c}}return this.estimateUserOperationGas(t.userOperation)}catch{return this.estimateUserOperationGas(t.userOperation)}});h(this,"getGasPrice",async()=>{const{fast:t}=await this.bundlerClient.getUserOperationGasPrice();return{maxFeePerGas:BigInt(t.maxFeePerGas),maxPriorityFeePerGas:BigInt(t.maxPriorityFeePerGas)}});h(this,"estimateUserOperationGas",async t=>{try{const n=await this.bundlerClient.estimateUserOperationGas({userOperation:t}),i=await this.getGasPrice();return{...t,preVerificationGas:BigInt(n.preVerificationGas),verificationGasLimit:BigInt(n.verificationGasLimit),callGasLimit:BigInt(n.callGasLimit),maxPriorityFeePerGas:BigInt(i.maxPriorityFeePerGas),maxFeePerGas:BigInt(i.maxFeePerGas)}}catch{return t}});h(this,"sendTransaction",async({to:t,value:n,data:i})=>{const r=await this.account.encodeCallData({to:t,value:n||BigInt(0),data:i||"0x"}),o=await this.smartAccountClient.prepareUserOperationRequest({userOperation:{callData:r},account:this.account}),c=await this.sponsorUserOperation({userOperation:o,entryPoint:this.entryPoint}),l=await this.account.signUserOperation(c),d={...c,signature:l},u=await this.bundlerClient.sendUserOperation({userOperation:{...d,nonce:BigInt(d.nonce)}});return(await this.bundlerClient.waitForUserOperationReceipt({hash:u})).receipt.transactionHash});h(this,"estimateGas",async t=>{let n=0n;if(!this.isDeployed){const r=await this.publicClient.getGasPrice(),o=Ce/2,c=21e3,l=o*200,d=c+l;n=BigInt(d)*r}return await this.publicClient.estimateGas({...t,account:this.account.address})+n});h(this,"rpcRequest",async t=>{var n;switch(t.method){case"eth_estimateGas":{const r=(n=t.params)==null?void 0:n[0];return this.estimateGas(r)}case"eth_sendTransaction":{const{to:r,value:o,data:c}=t.params[D.eth_sendTransaction];return this.sendTransaction({to:r,value:BigInt(o)||BigInt(0),data:c})}case"personal_sign":return this.signMessage(t.params[D.eth_personalSign]);case"eth_signTypedData_v4":{const{domain:r,types:o,message:c,primaryType:l}=JSON.parse(t.params[D.eth_signTypedData_v4]);return this._signTypedData({domain:r,types:o,message:c,primaryType:l})}case"wallet_sendCalls":const{calls:i}=t.params[D.wallet_sendCalls];return this.sendCalls({calls:i});case"wallet_getCallsStatus":return this.getCallsStatus(t.params[D.wallet_getCallsStatus]);case"wallet_getCapabilities":return this.getWalletCapabilities();case"wallet_grantPermissions":{const r=t.params[D.wallet_grantPermissions];return await this.grantPermissions(r)}case"wallet_revokePermissions":{const r=t.params[D.wallet_revokePermissions];return await this.signMessage(P(r.pci))}default:return Pe({chain:this.chain,account:this.account,transport:L(Re({chain:this.chain,projectId:this.projectId}))}).request(t)}});h(this,"getWalletCapabilities",async(t=this.address)=>{if(t!==this.address)throw new Error(`Cannot fetch capabilities for an address different than ${this.address}`);const n=new Set(Rt.map(r=>P(r.id))),i=new Set(ke.map(r=>P(r.id)));return Array.from(i).reduce((r,o)=>(r[o]={...i.has(o)&&{atomicBatch:{supported:!0}},...n.has(o)&&{permissions:{supported:!0,signerTypes:["keys"],permissionTypes:["contract-call"],policyTypes:[]}}},r),{})});h(this,"sendCalls",async({calls:t,capabilities:n})=>{var u,f;const i=t.map(p=>({to:p.to??"0x",data:p.data??"0x",value:p.value?Q(p.value,"bigint"):BigInt(0)})),r=await this.account.encodeCallData(i),o=await this.smartAccountClient.prepareUserOperationRequest({userOperation:{callData:r},account:this.account}),c=await this.sponsorUserOperation({userOperation:o,entryPoint:this.entryPoint,paymasterUrl:(u=n==null?void 0:n.paymasterService)==null?void 0:u.url,paymasterContext:(f=n==null?void 0:n.paymasterService)==null?void 0:f.context}),l=await this.account.signUserOperation(c);return c.signature=l,await this.smartAccountClient.sendUserOperation({userOperation:c,account:this.account})});h(this,"getCallsStatus",async t=>{const n=await this.bundlerClient.getUserOperationReceipt({hash:t});return{status:n?"CONFIRMED":"PENDING",receipts:n?[{logs:n.logs.map(r=>({data:r.data,address:r.address,topics:r.topics})),blockHash:n.receipt.blockHash,blockNumber:P(n.receipt.blockNumber),gasUsed:P(n.actualGasUsed),transactionHash:n.receipt.transactionHash,status:n.success?"0x1":"0x0"}]:void 0}});this.checkForDeployment(),this.bundlerClient=Et({transport:L(Ae({chain:this.chain,projectId:r}),{timeout:3e4}),chain:this.chain,entryPoint:this.entryPoint})}getClientConfig(){return{name:"SafeEntryPointV7SmartAccount",entryPoint:xe,chain:this.chain,bundlerTransport:L(Ae({chain:this.chain,projectId:this.projectId}),{timeout:3e4})}}async grantPermissions(t){if(!Jn(this.chain.id))throw new Error("Chain not supported for wallet_grantPermissions rpc call");await this.ensureAccountReadyForGrantPermissions();const i=await xt(this.provider),r=Pe({chain:this.chain,account:i.address,transport:cn(this.provider)}),o=await rs(this.publicClient,r,{account:Ye({address:this.account.address,type:"safe"}),grantPermissionsRequest:t});return{...t,context:o,chainId:P(this.chain.id),accountMeta:{factory:await this.account.getFactory()||"0x",factoryData:await this.account.getFactoryData()||"0x"},expiry:t.expiry}}async ensureAccountReadyForGrantPermissions(){try{const t=[],n=jn({}),[i,r]=await Promise.all([wt(this.publicClient,this.account.address),this.isSmartAccountTrustSmartSessionAttesters()]);let o=!1;if(i&&(o=await this.isModuleInstalled(n),o&&r))return;if(!i||!o){const l=await Tn({client:this.publicClient,account:Ye({address:this.account.address,type:"safe"}),module:n});t.push(l[0])}if(!r){const l=Un({attesters:[at],threshold:1});t.push(l)}const c=await this.sendCalls({calls:t.map(l=>({to:l.target,value:P(l.value.valueOf()),data:l.callData}))});await this.bundlerClient.waitForUserOperationReceipt({hash:c})}catch(t){throw t}}async isSmartAccountTrustSmartSessionAttesters(){const t=await Fn({client:this.publicClient,accountAddress:this.account.address});return t.length>0?!!t.find(n=>n.toLowerCase()===at.toLowerCase()):!1}async isModuleInstalled(t){return this.smartAccountClient.extend(Cn({entryPoint:this.entryPoint})).isModuleInstalled({address:t.module,type:t.type,account:this.account,context:t.initData||"0x"})}};h(be,"fromProvider",async t=>{const n=await re.getAccountFromProvider({provider:t.provider,chain:t.chain,projectId:t.projectId,entryPointVersion:"v0.7"});return new be({...t,account:n})});let Ne=be;const _e=class _e extends re{constructor({provider:t,account:n,chain:i,projectId:r,testSponsor:o=!1}){super({provider:t,entryPoint:Z,account:n,chain:i,projectId:r,testSponsor:o});h(this,"bundlerClient");h(this,"getGasPrice",async()=>{const{fast:t}=await this.bundlerClient.getUserOperationGasPrice();return{maxFeePerGas:BigInt(t.maxFeePerGas),maxPriorityFeePerGas:BigInt(t.maxPriorityFeePerGas)}});h(this,"sponsorUserOperation",async t=>{if(this.testSponsor){const i=await this.paymasterClient.sponsorUserOperation(t);return{...t.userOperation,...i}}try{if(t.paymasterUrl){const i=ht({chain:this.chain,transport:L(t.paymasterUrl)}).extend(vt(Z)),r=await i.getPaymasterStubData({userOperation:t.userOperation,context:t.paymasterContext}),o=await this.bundlerClient.estimateUserOperationGas({userOperation:{...t.userOperation,paymasterAndData:r.paymasterAndData}}),{paymasterAndData:c}=await i.getPaymasterData({userOperation:{...t.userOperation,...o,paymasterAndData:r.paymasterAndData},context:t.paymasterContext});return{...t.userOperation,...o,paymasterAndData:c}}if(!this.isDeployed){const i=Ie(this.chain.id);if(i)return await U.sponsorDeployTransaction(t.userOperation,i,this.projectId)}const n=Se(this.chain.id);return n&&U.state.paymentToken?await U.sponsorUserOperationWithERC20(t.userOperation,n,U.state.paymentToken,this.projectId,this):this.estimateUserOperationGas(t.userOperation)}catch{return this.estimateUserOperationGas(t.userOperation)}});h(this,"encodeTransactionToPartialUserOp",async({to:t,value:n,data:i})=>{const r=await this.account.encodeCallData({to:t,value:n||BigInt(0),data:i||"0x"}),{maxFeePerGas:o,maxPriorityFeePerGas:c}=await this.getGasPrice(),l={callData:r,maxFeePerGas:o,maxPriorityFeePerGas:c,sender:this.account.address,nonce:await this.getNonce(),initCode:await this.account.getInitCode(),signature:"0x",paymasterAndData:"0x",callGasLimit:BigInt(0),verificationGasLimit:BigInt(0),preVerificationGas:BigInt(0)};return l.signature=await this.account.getDummySignature(l),l});h(this,"sendTransaction",async({to:t,value:n,data:i})=>{const r=await this.encodeTransactionToPartialUserOp({to:t,value:n,data:i}),o=await this.sponsorUserOperation({userOperation:r,entryPoint:this.entryPoint}),c=await this.account.signUserOperation(o),l={...o,signature:c},d=await this.bundlerClient.sendUserOperation({userOperation:{...l,nonce:BigInt(l.nonce)}});return(await this.bundlerClient.waitForUserOperationReceipt({hash:d})).receipt.transactionHash});h(this,"estimateUserOperationGas",async t=>{try{const n=await this.bundlerClient.estimateUserOperationGas({userOperation:t}),i=await this.getGasPrice();return{...t,preVerificationGas:BigInt(n.preVerificationGas),verificationGasLimit:BigInt(n.verificationGasLimit),callGasLimit:BigInt(n.callGasLimit),maxPriorityFeePerGas:BigInt(i.maxPriorityFeePerGas),maxFeePerGas:BigInt(i.maxFeePerGas)}}catch{return t}});h(this,"isDeploymentSponsored",()=>!!Ie(this.chain.id));h(this,"getDeploymentCost",async()=>{if(this.isDeployed||this.isDeploymentSponsored())return 0n;const t=await this.publicClient.getGasPrice(),n=Ce/2,i=21e3,r=n*200,o=i+r;return BigInt(o)*t});h(this,"estimateGas",async t=>{let n=0n;if(!this.isDeployed){const i=await this.publicClient.getGasPrice(),r=Ce/2,o=21e3,c=r*200,l=o+c;n=BigInt(l)*i}try{return await this.publicClient.estimateGas({...t,account:this.account.address})+n}catch(i){if(Se(this.chain.id))return 0n;throw i}});h(this,"rpcRequest",async t=>{var n;switch(t.method){case"eth_estimateGas":{const r=(n=t.params)==null?void 0:n[0];return this.estimateGas(r)}case"eth_sendTransaction":{const{to:r,value:o,data:c}=t.params[D.eth_sendTransaction];return this.sendTransaction({to:r,value:BigInt(o||0),data:c})}case"personal_sign":return this.signMessage(t.params[D.eth_personalSign]);case"eth_signTypedData_v4":{const{domain:r,types:o,message:c,primaryType:l}=JSON.parse(t.params[D.eth_signTypedData_v4]);return this._signTypedData({domain:r,types:o,message:c,primaryType:l})}case"wallet_sendCalls":const i=t.params[D.wallet_sendCalls];return this.sendCalls({calls:i.calls,capabilities:i.capabilities});case"wallet_getCallsStatus":return this.getCallsStatus(t.params[D.wallet_getCallsStatus]);case"wallet_getCapabilities":return this.getWalletCapabilities();default:return Pe({chain:this.chain,account:this.account,transport:L(Re({chain:this.chain,projectId:this.projectId}))}).request(t)}});h(this,"getWalletCapabilities",async(t=this.address)=>{if(t!==this.address)throw new Error(`Cannot fetch capabilities for an address  different than ${this.address}`);return ke.map(i=>P(i.id)).reduce((i,r)=>(i[r]={atomicBatch:{supported:!0},paymasterService:{supported:!0}},i),{})});h(this,"sendCalls",async({calls:t,capabilities:n})=>{var u,f;const i=t.map(p=>({to:p.to??"0x",data:p.data??"0x",value:p.value?Q(p.value,"bigint"):BigInt(0)})),r=await this.account.encodeCallData(i),o=await this.smartAccountClient.prepareUserOperationRequest({userOperation:{callData:r},account:this.account}),c=await this.sponsorUserOperation({userOperation:o,entryPoint:this.entryPoint,paymasterUrl:(u=n==null?void 0:n.paymasterService)==null?void 0:u.url,paymasterContext:(f=n==null?void 0:n.paymasterService)==null?void 0:f.context}),l=await this.account.signUserOperation(c);return c.signature=l,await this.bundlerClient.sendUserOperation({userOperation:{...c,nonce:BigInt(c.nonce)}})});h(this,"getCallsStatus",async t=>{const n=await this.bundlerClient.getUserOperationReceipt({hash:t});return{status:n?"CONFIRMED":"PENDING",receipts:n?[{logs:n.logs.map(r=>({data:r.data,address:r.address,topics:r.topics})),blockHash:n.receipt.blockHash,blockNumber:P(n.receipt.blockNumber),gasUsed:P(n.actualGasUsed),transactionHash:n.receipt.transactionHash,status:n.success?"0x1":"0x0"}]:void 0}});h(this,"getBatchedUserOperation",async({calls:t})=>{const n=await this.account.encodeCallData(t.map(c=>({to:c.to||"0x",value:c.value||BigInt(0),data:c.data||"0x"}))),i=await this.getGasPrice(),r={sender:this.account.address,callData:n||"0x",nonce:await this.getNonce(),initCode:await this.account.getInitCode(),paymasterAndData:"0x",signature:"0x",verificationGasLimit:0n,preVerificationGas:0n,callGasLimit:0n,...i},o=await this.estimateUserOperationGas(r);return o.signature=await this.account.signUserOperation(o),o});this.bundlerClient=Et({transport:L(Ae({chain:this.chain,projectId:r}),{timeout:3e4}),chain:this.chain,entryPoint:this.entryPoint}),this.testSponsor=o}getClientConfig(){return{name:"SafeEntryPointV6SmartAccount",entryPoint:Z,chain:this.chain,bundlerTransport:L(Ae({chain:this.chain,projectId:this.projectId}),{timeout:3e4}),middleware:{gasPrice:()=>this.getGasPrice()}}}};h(_e,"fromProvider",async t=>{const n=await re.getAccountFromProvider({provider:t.provider,chain:t.chain,projectId:t.projectId,entryPointVersion:"v0.6"}),i=new _e({...t,account:n});return await i.checkForDeployment(),i});let Oe=_e;const ws="debug";class Es{constructor(e,t="eip155:1",n=1){h(this,"w3mFrame");h(this,"magic");h(this,"smartAccount",null);h(this,"chainId",null);h(this,"projectId");h(this,"connectFarcasterId");h(this,"preferredAccount",M.eoa);h(this,"logger");h(this,"chunkLoggerController");h(this,"getPreferredAccountType",async e=>{const t=await this.getChainId();if(!ge(t)||!et(R.state.sdkVersion,R.state.sdkType))return M.eoa;const n=await Qe.getPreferredAccount(e.address);return n||(await this.magic.rpcRequest({method:"eth_getBalance",params:[e.address,"latest"]})!=="0x0"?M.eoa:M.smartAccount)});h(this,"getAccounts",async e=>{var i;const t=ge(e.chainId),n={type:"eoa",address:e.address};if(t){this.smartAccount=await this.initSmartAccount(e.chainId);const r={type:"smartAccount",address:(i=this.smartAccount)==null?void 0:i.account.address};return await this.shouldUseSmartAccount()?[r,n]:[n,r]}return[n]});var l;const i=new yt(e);this.magic=new Mn(t,e),this.w3mFrame=i,this.projectId=e;const r=Zt({level:ws}),{logger:o,chunkLoggerController:c}=Xt({opts:r});this.logger=ea(o,this.constructor.name),this.chunkLoggerController=c,typeof window!==void 0&&((l=this.chunkLoggerController)!=null&&l.downloadLogsBlobInBrowser)&&(window.dowdownloadAppKitLogsBlob||(window.downloadAppKitLogsBlob={}),window.downloadAppKitLogsBlob["secure-site"]=()=>{var d;(d=this.chunkLoggerController)!=null&&d.downloadLogsBlobInBrowser&&this.chunkLoggerController.downloadLogsBlobInBrowser({projectId:e})}),this.w3mFrame.events.onAppEvent(d=>{switch(this.logger.info({event:d},"Event received"),d.type){case m.APP_SWITCH_NETWORK:return this.onSwitchNetwork(d);case m.APP_CONNECT_EMAIL:return this.onConnectEmail(d);case m.APP_CONNECT_DEVICE:return this.onConnectDevice(d);case m.APP_CONNECT_OTP:return this.onConnectOtp(d);case m.APP_CONNECT_SOCIAL:return this.onConnectSocial(d);case m.APP_GET_FARCASTER_URI:return this.onGetFarcasterUri(d);case m.APP_CONNECT_FARCASTER:return this.onConnectFarcaster(d);case m.APP_GET_USER:return this.onGetUser(d);case m.APP_SIGN_OUT:return this.onSignOut(d);case m.APP_IS_CONNECTED:return this.onIsConnected(d);case m.APP_GET_CHAIN_ID:return this.onGetChainId(d);case m.APP_RPC_REQUEST:return this.onRpcRequest(d);case m.APP_UPDATE_EMAIL:return this.onUpdateEmail(d);case m.APP_UPDATE_EMAIL_PRIMARY_OTP:return this.onUpdateEmailPrimaryOtp(d);case m.APP_UPDATE_EMAIL_SECONDARY_OTP:return this.onUpdateEmailSecondaryOtp(d);case m.APP_SYNC_THEME:return this.onSyncTheme(d);case m.APP_SYNC_DAPP_DATA:return this.onSyncDappData(d);case m.APP_GET_SMART_ACCOUNT_ENABLED_NETWORKS:return this.onSmartAccountEnabledNetworks(d);case m.APP_SET_PREFERRED_ACCOUNT:return this.onSetPreferredAccount(d);case m.APP_GET_SOCIAL_REDIRECT_URI:return this.onGetSocialRedirectUri(d);default:return null}}),n>1&&this.w3mFrame.events.postFrameEvent({type:m.FRAME_READY,payload:{}})}async getChainId(){return this.chainId||(this.chainId=await this.magic.getChainId()),this.chainId}async approveRequest(e){const t=e.payload;try{S.loading();let n=null;await this.shouldUseSmartAccount()?n=await this.approveRequestWithSmartAccount(t):n=await this.magic.rpcRequest(t),this.w3mFrame.events.postFrameEvent({id:e.id,type:m.FRAME_RPC_REQUEST_SUCCESS,payload:n}),S.close()}catch(n){this.w3mFrame.events.postFrameEvent({id:e.id,type:m.FRAME_RPC_REQUEST_ERROR,payload:{message:n.message}}),S.loading(!1)}finally{[...ve.SAFE_RPC_METHODS,"wallet_getCallsStatus","wallet_getCapabilities"].includes(t.method)||S.close()}}async rejectRequest(e){S.loading(),this.w3mFrame.events.postFrameEvent({id:e.id,type:m.FRAME_RPC_REQUEST_ERROR,payload:{message:"User rejected"}}),S.close()}async errorRequest(e,t){S.loading(),this.w3mFrame.events.postFrameEvent({id:e.id,type:m.FRAME_RPC_REQUEST_ERROR,payload:{message:t}}),S.close()}async shouldUseSmartAccount(e=this.preferredAccount){const t=await this.getChainId();return ge(t)&&e===M.smartAccount}async approveRequestWithSmartAccount(e){if(!await this.shouldUseSmartAccount())throw new Error("Smart account not enabled");return(await this.getSmartAccount(this.chainId)).rpcRequest(e)}async initSmartAccount(e){const t=ie[e],n=await this.magic.getProvider(),i=await this.magic.getUser();return ts(t,i.email)?await Ne.fromProvider({provider:n,chain:t,projectId:this.projectId,testSponsor:!0}):await Oe.fromProvider({provider:n,chain:t,projectId:this.projectId,testSponsor:!1})}async getSmartAccount(e){return this.smartAccount||(this.smartAccount=await this.initSmartAccount(e)),this.smartAccount}async onSwitchNetwork({payload:e,id:t}){try{const n=j.createNetwork(e.chainId,this.projectId);n||this.w3mFrame.events.postFrameEvent({id:t,type:m.FRAME_SWITCH_NETWORK_ERROR,payload:{message:"Invalid Network"}}),this.chainId=e.chainId,await this.magic.switchNetwork(n),await this.shouldUseSmartAccount()&&(this.smartAccount=await this.initSmartAccount(j.getEvmChainId(e.chainId))),this.w3mFrame.events.postFrameEvent({id:t,type:m.FRAME_SWITCH_NETWORK_SUCCESS,payload:{chainId:j.prepareChainIdResponse(n.chainId)}})}catch(n){this.w3mFrame.events.postFrameEvent({id:t,type:m.FRAME_SWITCH_NETWORK_ERROR,payload:{message:n.message}})}}async onConnectEmail({payload:e,id:t}){try{await this.magic.connectEmail(e.email,n=>{this.w3mFrame.events.postFrameEvent({id:t,type:m.FRAME_CONNECT_EMAIL_SUCCESS,payload:n})},n=>{this.w3mFrame.events.postFrameEvent({id:t,type:m.FRAME_CONNECT_EMAIL_ERROR,payload:{message:F.parseMagicError(n).message}})})}catch(n){this.w3mFrame.events.postFrameEvent({id:t,type:m.FRAME_CONNECT_EMAIL_ERROR,payload:{message:F.parseMagicError(n).message}})}}async onGetFarcasterUri({id:e}){try{await this.magic.connectFarcaster(t=>{this.w3mFrame.events.postFrameEvent({id:e,type:m.FRAME_GET_FARCASTER_URI_SUCCESS,payload:t})},t=>{this.w3mFrame.events.postFrameEvent({id:this.connectFarcasterId,type:m.FRAME_CONNECT_FARCASTER_SUCCESS,payload:{userName:t.username}})},t=>{this.w3mFrame.events.postFrameEvent({id:this.connectFarcasterId,type:m.FRAME_CONNECT_FARCASTER_ERROR,payload:{message:F.parseMagicError(t).message}})})}catch(t){this.w3mFrame.events.postFrameEvent({type:m.FRAME_CONNECT_FARCASTER_ERROR,payload:{message:F.parseMagicError(t).message}})}}onConnectFarcaster({id:e}){this.connectFarcasterId=e}async onConnectDevice({id:e}){try{await this.magic.connectEmailDevice(()=>{this.w3mFrame.events.postFrameEvent({id:e,type:m.FRAME_CONNECT_DEVICE_SUCCESS})},t=>{this.w3mFrame.events.postFrameEvent({id:e,type:m.FRAME_CONNECT_DEVICE_ERROR,payload:{message:F.parseMagicError(t).message}})})}catch(t){this.w3mFrame.events.postFrameEvent({id:e,type:m.FRAME_CONNECT_DEVICE_ERROR,payload:{message:F.parseMagicError(t).message}})}}async onConnectOtp({payload:e,id:t}){try{await this.magic.connectEmailOtp(e.otp,async()=>{this.w3mFrame.events.postFrameEvent({id:t,type:m.FRAME_CONNECT_OTP_SUCCESS});const n="TODO: Placeholder session token";n&&this.w3mFrame.events.postFrameEvent({id:t,type:m.FRAME_SESSION_UPDATE,payload:{token:n}})},n=>this.w3mFrame.events.postFrameEvent({id:t,type:m.FRAME_CONNECT_OTP_ERROR,payload:{message:F.parseMagicError(n).message}}))}catch(n){this.w3mFrame.events.postFrameEvent({id:t,type:m.FRAME_CONNECT_OTP_ERROR,payload:{message:F.parseMagicError(n).message}})}}async onConnectSocial({payload:e,id:t}){var n,i,r,o,c,l,d,u,f,p,y,E,w,I;try{const v=await this.magic.connectSocial(e.uri);if(v){const C=await this.getChainId();if((i=(n=v.magic)==null?void 0:n.userMetadata)!=null&&i.publicAddress&&((o=(r=v.magic)==null?void 0:r.userMetadata)!=null&&o.email||(l=(c=v.oauth)==null?void 0:c.userInfo)!=null&&l.username))this.w3mFrame.events.postFrameEvent({id:t,type:m.FRAME_CONNECT_SOCIAL_SUCCESS,payload:{email:(u=(d=v.magic)==null?void 0:d.userMetadata)!=null&&u.email?(p=(f=v.magic)==null?void 0:f.userMetadata)==null?void 0:p.email:(E=(y=v.oauth)==null?void 0:y.userInfo)==null?void 0:E.username,address:v.magic.userMetadata.publicAddress,chainId:C,userName:(I=(w=v.oauth)==null?void 0:w.userInfo)==null?void 0:I.username}});else throw new Error("User data not available")}}catch(v){this.w3mFrame.events.postFrameEvent({id:t,type:m.FRAME_CONNECT_SOCIAL_ERROR,payload:{message:v.message}})}}async onGetUser({payload:e,id:t}){var n,i;try{e!=null&&e.chainId&&await this.magic.switchNetwork(j.createNetwork(e.chainId,this.projectId));const r=await this.magic.getUser();this.chainId=r.chainId,this.preferredAccount=await this.getPreferredAccountType(r);const o=await this.getAccounts(r),c=await this.shouldUseSmartAccount(),l=((n=this.smartAccount)==null?void 0:n.isDeployed)||!1;this.w3mFrame.events.postFrameEvent({id:t,type:m.FRAME_GET_USER_SUCCESS,payload:{...r,address:c&&this.smartAccount?(i=this.smartAccount)==null?void 0:i.account.address:r.address,smartAccountDeployed:l,preferredAccountType:this.preferredAccount,accounts:o}})}catch(r){this.w3mFrame.events.postFrameEvent({id:t,type:m.FRAME_GET_USER_ERROR,payload:{message:F.parseMagicError(r).message}})}}async onSignOut({id:e}){try{await this.magic.signOut(),this.smartAccount=null,this.w3mFrame.events.postFrameEvent({id:e,type:m.FRAME_SIGN_OUT_SUCCESS})}catch(t){this.w3mFrame.events.postFrameEvent({id:e,type:m.FRAME_SIGN_OUT_ERROR,payload:{message:t.message}})}}async onIsConnected({payload:e,id:t}){try{e&&console.info(e.token),await this.magic.preload();const n=await this.magic.isConnected(),i=Ln.isShortSession();if(n&&i){await this.magic.signOut(),this.w3mFrame.events.postFrameEvent({id:t,type:m.FRAME_IS_CONNECTED_SUCCESS,payload:{isConnected:!1}});return}this.w3mFrame.events.postFrameEvent({id:t,type:m.FRAME_IS_CONNECTED_SUCCESS,payload:{isConnected:n}})}catch(n){this.w3mFrame.events.postFrameEvent({id:t,type:m.FRAME_IS_CONNECTED_ERROR,payload:{message:n.message}})}}async onGetChainId(e){try{this.chainId=await this.magic.getChainId(),this.w3mFrame.events.postFrameEvent({id:e.id,type:m.FRAME_GET_CHAIN_ID_SUCCESS,payload:{chainId:this.chainId}})}catch(t){this.w3mFrame.events.postFrameEvent({id:e.id,type:m.FRAME_GET_CHAIN_ID_ERROR,payload:{message:t.message}})}}async onRpcRequest(e){[...ve.SAFE_RPC_METHODS,"wallet_getCallsStatus","wallet_getCapabilities"].includes(e.payload.method)?await this.approveRequest(e):S.open(e)}async onUpdateEmail({payload:e,id:t}){const n=e.email;try{await this.magic.updateEmail(n,i=>{this.w3mFrame.events.postFrameEvent({id:t,type:m.FRAME_UPDATE_EMAIL_SUCCESS,payload:i})},i=>{this.w3mFrame.events.postFrameEvent({id:t,type:m.FRAME_UPDATE_EMAIL_ERROR,payload:{message:F.parseMagicError(i).message}})})}catch(i){this.w3mFrame.events.postFrameEvent({id:t,type:m.FRAME_UPDATE_EMAIL_ERROR,payload:{message:F.parseMagicError(i).message}})}}async onUpdateEmailPrimaryOtp({payload:e,id:t}){const n=e.otp;try{await this.magic.updateEmailPrimaryOtp(n,()=>{this.w3mFrame.events.postFrameEvent({id:t,type:m.FRAME_UPDATE_EMAIL_PRIMARY_OTP_SUCCESS})},i=>{this.w3mFrame.events.postFrameEvent({id:t,type:m.FRAME_UPDATE_EMAIL_PRIMARY_OTP_ERROR,payload:{message:F.parseMagicError(i).message}})})}catch(i){this.w3mFrame.events.postFrameEvent({id:t,type:m.FRAME_UPDATE_EMAIL_PRIMARY_OTP_ERROR,payload:{message:F.parseMagicError(i).message}})}}async onUpdateEmailSecondaryOtp({payload:e,id:t}){const n=e.otp;try{await this.magic.updateEmailSecondaryOtp(n,i=>{this.w3mFrame.events.postFrameEvent({id:t,type:m.FRAME_UPDATE_EMAIL_SECONDARY_OTP_SUCCESS,payload:i})},i=>{this.w3mFrame.events.postFrameEvent({id:t,type:m.FRAME_UPDATE_EMAIL_SECONDARY_OTP_ERROR,payload:{message:F.parseMagicError(i).message}})})}catch(i){this.w3mFrame.events.postFrameEvent({id:t,type:m.FRAME_UPDATE_EMAIL_SECONDARY_OTP_ERROR,payload:{message:F.parseMagicError(i).message}})}}async onSyncTheme({payload:e,id:t}){It.setTheme(e),this.w3mFrame.events.postFrameEvent({id:t,type:m.FRAME_SYNC_THEME_SUCCESS})}onSyncDappData({payload:e,id:t}){R.setDappData(e),this.w3mFrame.events.postFrameEvent({id:t,type:m.FRAME_SYNC_DAPP_DATA_SUCCESS})}async onSmartAccountEnabledNetworks({id:e}){let t=Object.keys(ie).map(Number);et(R.state.sdkVersion,R.state.sdkType)||(t=[]),this.w3mFrame.events.postFrameEvent({id:e,type:m.FRAME_GET_SMART_ACCOUNT_ENABLED_NETWORKS_SUCCESS,payload:{smartAccountEnabledNetworks:t}})}async onSetPreferredAccount({payload:e,id:t}){if(e.type!==M.eoa&&e.type!==M.smartAccount){this.w3mFrame.events.postFrameEvent({id:t,type:m.FRAME_SET_PREFERRED_ACCOUNT_ERROR,payload:{message:"Invalid preferred account type"}});return}const n=await this.magic.getUser();if(e.type===M.smartAccount){if(!ge(n.chainId)){this.w3mFrame.events.postFrameEvent({id:t,type:m.FRAME_SET_PREFERRED_ACCOUNT_ERROR,payload:{message:"Smart accounts not enabled for chain"}});return}this.setPreferredAccount(n.address,M.smartAccount);const i=await this.getSmartAccount(n.chainId);this.w3mFrame.events.postFrameEvent({id:t,type:m.FRAME_SET_PREFERRED_ACCOUNT_SUCCESS,payload:{type:this.preferredAccount,address:i.address}})}else this.setPreferredAccount(n.address,M.eoa),this.w3mFrame.events.postFrameEvent({id:t,type:m.FRAME_SET_PREFERRED_ACCOUNT_SUCCESS,payload:{type:this.preferredAccount,address:n.address}})}async setPreferredAccount(e,t){this.preferredAccount=t,await Qe.setPreferredAccount(e,t)}async onGetSocialRedirectUri({payload:e,id:t}){const n=await this.magic.getSocialRedirectUri(e.provider);this.w3mFrame.events.postFrameEvent({id:t,type:m.FRAME_GET_SOCIAL_REDIRECT_URI_SUCCESS,payload:{uri:n}})}}const H={isMobile(a){return a<=767},getSpacingStyles(a,e){return Array.isArray(a)?a[e]?`var(--spacing-${a[e]})`:void 0:`var(--spacing-${a})`},getTruncateString({string:a,charsStart:e,charsEnd:t,truncate:n}){return a.length<=e+t?a:n==="end"?`${a.substring(0,e)}...`:n==="start"?`...${a.substring(a.length-t)}`:`${a.substring(0,Math.floor(e))}...${a.substring(a.length-Math.floor(t))}`},cn(...a){return ta(aa(a))},getBorderRadiusTypeForWallets(a){return a.map((e,t)=>({idx:t,rounded:e}))}},vs="_flex_1t96k_1",Cs={flex:vs};function g({children:a,className:e="",gridColumnStart:t,gridColumnEnd:n,flexDirection:i,flexWrap:r,flexBasis:o,flexGrow:c,flexShrink:l,alignItems:d,justifyContent:u,columnGap:f,rowGap:p,gap:y,padding:E,margin:w,width:I,onClick:v}){const C={gridColumnStart:t,gridColumnEnd:n,flexDirection:i,flexWrap:r,flexBasis:o,flexGrow:c,flexShrink:l,alignItems:d,justifyContent:u,width:I,columnGap:f&&`var(--spacing-${f})`,rowGap:p&&`var(--spacing-${p})`,gap:y&&`var(--spacing-${y})`,paddingTop:E&&H.getSpacingStyles(E,0),paddingRight:E&&H.getSpacingStyles(E,1),paddingBottom:E&&H.getSpacingStyles(E,2),paddingLeft:E&&H.getSpacingStyles(E,3),marginTop:w&&H.getSpacingStyles(w,0),marginRight:w&&H.getSpacingStyles(w,1),marginBottom:w&&H.getSpacingStyles(w,2),marginLeft:w&&H.getSpacingStyles(w,3)};return s.jsx("div",{className:`${Cs.flex} ${e}`,style:C,onClick:v,children:a})}function Is({frameSdk:a}){var l,d;const{loading:e,event:t}=x(S.state),{chainImage:n,chainName:i}=x(A.state),{metadata:r,verified:o}=x(R.state);if(((l=t==null?void 0:t.payload)==null?void 0:l.method)!=="personal_sign"&&((d=t==null?void 0:t.payload)==null?void 0:d.method)!=="solana_signMessage")return null;const c=()=>{var u,f;try{switch(t.payload.method){case"personal_sign":return Q((f=(u=t==null?void 0:t.payload)==null?void 0:u.params)==null?void 0:f[0],"string");case"solana_signMessage":return new TextDecoder().decode(k.decode(t.payload.params.message));default:throw new Error("Unsupported method")}}catch{return"Could not parse message"}};return s.jsxs(g,{flexDirection:"column",padding:["0","m","0","m"],alignItems:"center",children:[s.jsx(g,{flexDirection:"column",padding:["5xxl","0","0","0"],alignItems:"center",children:s.jsx("wui-visual-thumbnail",{imageSrc:r==null?void 0:r.icons[0],borderRadiusFull:!0})}),s.jsx(g,{flexDirection:"column",padding:["xxl","xl","0","xl"],alignItems:"center",children:s.jsxs("wui-text",{variant:"paragraph-500",color:"fg-100",align:"center",children:[r==null?void 0:r.name," requests a signature"]})}),s.jsx(g,{flexDirection:"column",padding:["m","6xl","0","6xl"],alignItems:"center",children:s.jsx("wui-text",{variant:"small-400",color:"fg-200",align:"center",children:"Sign request to prove you own this wallet and to continue"})}),s.jsx(g,{flexDirection:"column",padding:["l","0","0","0"],alignItems:"center",children:s.jsx("wui-chip",{icon:o?"verifyFilled":"warningCircle",variant:o?"success":"error",href:r==null?void 0:r.url})}),!o&&s.jsx(g,{flexDirection:"column",padding:["xs","0","0","0"],alignItems:"center",children:s.jsx("wui-text",{variant:"small-400",color:"error-100",align:"center",children:"This domain cannot be verified. Check the request carefully before approving."})}),s.jsx(g,{flexDirection:"column",padding:["l","0","0","0"],alignItems:"center",width:"100%",children:s.jsx("wui-list-content",{textTitle:i,imageSrc:n})}),s.jsx(g,{flexDirection:"column",padding:["xs","0","0","0"],alignItems:"center",width:"100%",children:s.jsx("wui-list-accordion",{textTitle:"Message",overflowedContent:c()})}),s.jsx("div",{className:"signWrapper",children:e?s.jsxs(s.Fragment,{children:[s.jsx("wui-button",{fullWidth:!0,disabled:!0,size:"lg",borderRadius:"xs",variant:"neutral",children:"Cancel"}),s.jsx("wui-button",{fullWidth:!0,disabled:!0,loading:!0,size:"lg",borderRadius:"xs",variant:"main",children:"Sign"})]}):s.jsxs(s.Fragment,{children:[s.jsx("wui-button",{fullWidth:!0,size:"lg",borderRadius:"xs",variant:"neutral",onClick:()=>a==null?void 0:a.rejectRequest(t),children:"Cancel"}),s.jsx("wui-button",{fullWidth:!0,size:"lg",borderRadius:"xs",variant:"main",onClick:()=>a==null?void 0:a.approveRequest(t),children:"Sign"})]})})]})}function Ss({frameSdk:a}){var l;const{event:e,loading:t}=x(S.state),{chainImage:n,chainName:i}=x(A.state),{metadata:r,verified:o}=x(R.state);if(((l=e==null?void 0:e.payload)==null?void 0:l.method)!=="eth_signTypedData_v4")return null;const c=()=>{var d;try{const u=e==null?void 0:e.payload;return JSON.stringify(JSON.parse((d=u==null?void 0:u.params)==null?void 0:d[1]),null,2)}catch{return"Could not parse message"}};return s.jsxs(g,{flexDirection:"column",padding:["0","m","0","m"],alignItems:"center",children:[s.jsx(g,{flexDirection:"column",padding:["5xxl","0","0","0"],alignItems:"center",children:s.jsx("wui-visual-thumbnail",{imageSrc:r==null?void 0:r.icons[0],borderRadiusFull:!0})}),s.jsx(g,{flexDirection:"column",padding:["xxl","xl","0","xl"],alignItems:"center",children:s.jsxs("wui-text",{variant:"paragraph-500",color:"fg-100",align:"center",children:[r==null?void 0:r.name," requests a signature"]})}),s.jsx(g,{flexDirection:"column",padding:["m","6xl","0","6xl"],alignItems:"center",children:s.jsx("wui-text",{variant:"small-400",color:"fg-200",align:"center",children:"Sign request to prove you own this wallet and to continue"})}),s.jsx(g,{flexDirection:"column",padding:["l","0","0","0"],alignItems:"center",children:s.jsx("wui-chip",{icon:o?"verifyFilled":"warningCircle",variant:o?"success":"error",href:r==null?void 0:r.url})}),!o&&s.jsx(g,{flexDirection:"column",padding:["xs","0","0","0"],alignItems:"center",children:s.jsx("wui-text",{variant:"small-400",color:"error-100",align:"center",children:"This domain cannot be verified. Check the request carefully before approving."})}),s.jsx(g,{flexDirection:"column",padding:["l","0","0","0"],alignItems:"center",width:"100%",children:s.jsx("wui-list-content",{textTitle:i,imageSrc:n})}),s.jsx(g,{flexDirection:"column",padding:["xs","0","0","0"],alignItems:"center",width:"100%",children:s.jsx("wui-list-accordion",{textTitle:"Message",overflowedContent:c()})}),s.jsx("div",{className:"signWrapper",children:t?s.jsxs(s.Fragment,{children:[s.jsx("wui-button",{fullWidth:!0,disabled:!0,size:"lg",borderRadius:"xs",variant:"neutral",children:"Cancel"}),s.jsx("wui-button",{fullWidth:!0,disabled:!0,loading:!0,size:"lg",borderRadius:"xs",variant:"main",children:"Sign"})]}):s.jsxs(s.Fragment,{children:[s.jsx("wui-button",{fullWidth:!0,size:"lg",borderRadius:"xs",variant:"neutral",onClick:()=>a==null?void 0:a.rejectRequest(e),children:"Cancel"}),s.jsx("wui-button",{fullWidth:!0,size:"lg",borderRadius:"xs",variant:"main",onClick:()=>a==null?void 0:a.approveRequest(e),children:"Sign"})]})})]})}function Mt(){const[a,e]=b.useState(!0),{frameSdk:t}=x(Le.state),{chainId:n}=x(A.state),[i,r]=b.useState(null),o=async()=>{e(!0);const c=j.getEvmChainId(n);if(!c||!t){e(!1);return}const l=(t==null?void 0:t.preferredAccount)===ve.ACCOUNT_TYPES.SMART_ACCOUNT,d=ie[c];if(l&&d){const u=await t.initSmartAccount(c);r(u),e(!1)}else e(!1)};return b.useEffect(()=>{o()},[n,t]),{smartAccount:i,loading:a}}function As({smartAccount:a}){var C;const{event:e}=x(S.state),{projectId:t}=x(R.state),{chainId:n}=x(A.state),{paymentToken:i,quotes:r,balances:o}=x(U.state),[c,l]=b.useState(!1),[d,u]=b.useState(!1),f=b.useMemo(()=>r.find(T=>T.symbol===i)||null,[i,r]),p=e==null?void 0:e.payload,{to:y,data:E,value:w}=((C=p==null?void 0:p.params)==null?void 0:C[0])||{},I=async()=>{const T=j.getEvmChainId(n);if(!T||!a||d||a.entryPoint!==Z||!t)return;const K=Se(T);if(K)try{u(!0);const ae=await a.encodeTransactionToPartialUserOp({to:y,data:E,value:BigInt(w||0)});await U.getERC20GasQuotes(ae,K,t),u(!1)}catch{u(!1)}},v=async()=>{!a||c||(l(!0),await U.getBalance(a.account.address,j.getCaipChainId(n)),l(!1))};return b.useEffect(()=>{!(o!=null&&o.length)||!r.length||U.getAvailableGasPaymentTokens()},[o,r]),b.useEffect(()=>{I(),v()},[a,i]),{balanceLoading:c,quotesLoading:d,quotes:r,quote:f}}const bs="_paymentSelectorContainer_63wrn_1",_s={paymentSelectorContainer:bs};function Rs({onClose:a}){const{availableGasPaymentTokens:e}=x(U.state);return b.useEffect(()=>{U.getAvailableGasPaymentTokens()},[]),s.jsx("div",{className:_s.paymentSelectorContainer,onClick:a,children:e.map(t=>s.jsx("wui-token-list-item",{name:t.name,symbol:t.symbol,imageSrc:t.iconUrl,price:String(t.price),amount:String(t.quantity.numeric),onClick:()=>{U.state.paymentToken=t.symbol}}))})}const js="_payWithContainer_d4ld7_1",Ts={payWithContainer:js};function Ht(){var T;const{event:a}=x(S.state),{chainId:e,symbol:t,chainImage:n}=x(A.state),{paymentToken:i,availableGasPaymentTokens:r}=x(U.state),[o,c]=b.useState(!1),{smartAccount:l}=Mt(),{balanceLoading:d,quotesLoading:u,quote:f}=As({smartAccount:l}),p=a==null?void 0:a.payload,{gas:y}=((T=p==null?void 0:p.params)==null?void 0:T[0])||{};if((p==null?void 0:p.method)!=="eth_sendTransaction")return null;const E=j.getEvmChainId(e);if(!E)return null;const w=Se(E)&&l,I=Number(mt(Q(y||"0x0","bigint"))),v=()=>{(r==null?void 0:r.length)>1&&c(!0)};if(!w)return s.jsx("wui-details-group",{children:s.jsx("wui-details-group-item",{name:"Network cost",children:s.jsx("wui-text",{children:`${I<1e-4?"< 0.0001":`${I.toFixed(4)}`}${t||""}`})})});const C=(f==null?void 0:f.maxGasFeeUSD)||0;return s.jsx(s.Fragment,{children:s.jsxs("wui-details-group",{children:[s.jsx("wui-details-group-item",{name:"Network cost",children:u||d?s.jsx("wui-loading-spinner",{size:"lg"}):s.jsx("wui-text",{children:`${C?C<1e-4?"< $0.0001":`$${C.toFixed(4)}`:`${I<1e-4?"< 0.0001":`${I.toFixed(4)}`} ${t}`}`})}),s.jsxs("div",{className:Ts.payWithContainer,children:[o&&s.jsx(Rs,{onClose:()=>c(!1)}),s.jsx("wui-details-group-item",{name:"Pay with",children:s.jsx("wui-chip-button",{imageSrc:(f==null?void 0:f.logoUrl)||n,icon:"chevronRight",variant:"gray",size:"sm",text:i||t,onClick:v})})]}),f&&s.jsx("wui-details-group-item",{name:"Conversion rate",children:s.jsx("wui-text",{children:((f==null?void 0:f.exchangeRate)/10**(f==null?void 0:f.decimal)).toFixed(4)})})]})})}function Us(a){return a?a.replace(" Token",""):""}function Fs(){var f,p;const[a,e]=b.useState(void 0),{event:t}=x(S.state),{chainId:n,chainExplorerURL:i}=x(A.state),r=R.state.projectId||"",{to:o,from:c}=((p=(f=t==null?void 0:t.payload)==null?void 0:f.params)==null?void 0:p[0])||{},l=`${i}/address/${c}`;async function d(y,E){var I;const w=await jt.post({path:"/v1/fungible/price",headers:{"Content-Type":"application/json"}},{projectId:r,currency:"usd",addresses:[`eip155:${y}:${E}`]});e((I=w.fungibles)==null?void 0:I[0])}if(b.useEffect(()=>{const y=j.getEvmChainId(n);!y||!o||d(y,o)},[n,o]),!a)return null;const u=Us(a.name);return s.jsxs(s.Fragment,{children:[s.jsx("wui-visual-thumbnail",{imageSrc:a==null?void 0:a.iconUrl,borderRadiusFull:!0}),s.jsxs("wui-text",{variant:"paragraph-500",color:"fg-100",align:"center",children:["Approve ",u]}),s.jsx("wui-text",{variant:"small-400",color:"fg-200",align:"center",children:"Non native tokens approval is required to enable transaction"}),s.jsxs("wui-details-group",{children:[s.jsx("wui-details-group-item",{name:"Sending",children:s.jsxs("wui-flex",{alignItems:"center",gap:"s",children:[s.jsxs("wui-text",{variant:"paragraph-400",color:"fg-100",children:["Unlimited ",a==null?void 0:a.symbol]}),s.jsx("wui-image",{size:"md",src:a==null?void 0:a.iconUrl,alt:"Token logo"})]})}),s.jsx("wui-details-group-item",{name:"To",children:s.jsx("wui-chip",{href:l,title:Me.getTruncateString({string:o,truncate:"middle",charsStart:4,charsEnd:4}),variant:"transparent"})})]}),s.jsx(Ht,{})]})}const Ps="_activationFee_y40ct_1",Ds="_wcLogo_y40ct_9",Ns="_tooltip_y40ct_14",Te={activationFee:Ps,wcLogo:Ds,tooltip:Ns};function Os({smartAccount:a}){var v;const{event:e}=x(S.state),{projectId:t}=x(R.state),{chainId:n,decimals:i}=x(A.state),[r,o]=b.useState(!0),[c,l]=b.useState(null),[d,u]=b.useState(!1),f=e==null?void 0:e.payload,{to:p,data:y,value:E}=((v=f==null?void 0:f.params)==null?void 0:v[0])||{},w=async()=>{if(!a){o(!1);return}const C=await a.getDeploymentCost(),T=Number(gt(C,i));T<1e-4?l("< 0.0001"):l(T.toFixed(4))},I=async()=>{const C=j.getEvmChainId(n);if(!a||a.isDeployed!==!1||(a==null?void 0:a.entryPoint)!==Z||!C){o(!1);return}const T=await a.encodeTransactionToPartialUserOp({to:p,data:y,value:BigInt(E||0)}),K=await es({userOp:T,chainId:C,projectId:t||""});u(K)};return b.useEffect(()=>{w(),I()},[a]),{deploymentCost:c,isSponsored:d,loading:r}}function Ms(){const{loading:a,smartAccount:e}=Mt(),{deploymentCost:t,isSponsored:n,loading:i}=Os({smartAccount:e}),{symbol:r}=x(A.state),[o,c]=b.useState(!1),l=()=>n?"You do not have to pay activation fees for this transaction as they are sponsored by WalletConnnect.":"This fee is used to activate your Smart Account.";return a?null:(e==null?void 0:e.isDeployed)===!1?s.jsx("wui-details-group",{children:s.jsxs("div",{className:Te.activationFee,onMouseEnter:()=>c(!0),onMouseLeave:()=>c(!1),children:[o&&s.jsx("div",{className:Te.tooltip,children:s.jsx("wui-tooltip",{variant:"shade",placement:"top",message:l()})}),s.jsxs("wui-flex",{flexDirection:"column",justifyContent:"center",gap:"3xs",children:[s.jsx("wui-text",{variant:"paragraph-500",color:"fg-200",children:"Activation Fee"}),!i&&n&&s.jsxs("wui-flex",{alignItems:"center",gap:"3xs",children:[s.jsx("wui-flex",{flexShrink:"0",children:s.jsx("wui-text",{variant:"small-400",color:"fg-100",children:"Sponsored by"})}),s.jsx("img",{src:"/images/walletconnect_logo_blue.svg",className:Te.wcLogo})]})]}),s.jsx("wui-flex",{alignItems:"center",justifyContent:"flex-end",gap:"m",children:i?s.jsx("wui-loading-spinner",{size:"lg"}):n?s.jsx("wui-tag",{variant:"success",children:"Free"}):s.jsx("wui-text",{children:`${t} ${r}`})})]})}):null}function Hs(){var E;const{event:a}=x(S.state),{chainImage:e,chainName:t,chainExplorerURL:n,decimals:i}=x(A.state),{metadata:r,verified:o}=x(R.state),c=a==null?void 0:a.payload,{to:l,data:d,from:u,value:f}=((E=c==null?void 0:c.params)==null?void 0:E[0])||{},p=gt(Q(f||0,"bigint"),i),y=`${n}/address/${u}`;return s.jsxs(s.Fragment,{children:[s.jsx(g,{flexDirection:"column",alignItems:"center",children:s.jsx("wui-visual-thumbnail",{imageSrc:r==null?void 0:r.icons[0],borderRadiusFull:!0})}),s.jsx(g,{flexDirection:"column",alignItems:"center",children:s.jsxs("wui-text",{variant:"paragraph-500",color:"fg-100",align:"center",children:[r==null?void 0:r.name," requests a transaction"]})}),s.jsx(g,{flexDirection:"column",padding:["m","6xl","0","6xl"],alignItems:"center",children:s.jsx("wui-text",{variant:"small-400",color:"fg-200",align:"center",children:"Accept transaction to prove you own this wallet and to continue"})}),s.jsx(g,{flexDirection:"column",padding:["l","0","0","0"],alignItems:"center",children:s.jsx("wui-chip",{icon:o?"verifyFilled":"warningCircle",variant:o?"success":"error",href:r==null?void 0:r.url})}),o?null:s.jsx(g,{flexDirection:"column",padding:["xs","0","0","0"],alignItems:"center",children:s.jsx("wui-text",{variant:"small-400",color:"error-100",align:"center",children:"This domain cannot be verified. Check the request carefully before approving."})}),s.jsx(g,{flexDirection:"column",padding:["xxl","0","0","0"],alignItems:"center",width:"100%",children:s.jsx("wui-list-content",{textTitle:t,imageSrc:e})}),s.jsx(g,{flexDirection:"column",padding:["xs","0","0","0"],alignItems:"center",width:"100%",children:s.jsx("wui-list-wallet-transaction",{amount:p,networkImageUrl:e,addressExplorerUrl:y,receiverAddress:Me.getTruncateString({string:l,truncate:"middle",charsStart:4,charsEnd:4})})}),s.jsx(Ht,{}),s.jsx(Ms,{}),d?s.jsx(g,{flexDirection:"column",padding:["xs","0","0","0"],alignItems:"center",width:"100%",children:s.jsx("wui-list-accordion",{textTitle:"Call data",overflowedContent:d})}):null,s.jsx(g,{flexDirection:"column",padding:["xl","0","0","0"],alignItems:"center",children:s.jsx("wui-text",{variant:"small-400",color:"fg-200",align:"center",children:"Review transaction carefully"})})]})}const Lt=`${Be}/v1/ca/orchestrator`,Gt="1ff6b401d5f35caf8c0b8759d43698a0";async function kt(a,e){const t=await fetch(a,e);if(!t.ok){const n=await t.text();throw new Error(`Error ${t.status}: ${n}`)}return t.json()}async function Ls(a){const e=`${Lt}/route?projectId=${Gt}`;return await kt(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({transaction:a})})}async function Gs(a){const e=`${Lt}/status?projectId=${Gt}&orchestrationId=${a}`;return await kt(e)}class ks{constructor(e,t){this.apiKey=e,this.projectId=t}async executeTransaction(e){try{const t=j.createNetwork(e.chainId,this.projectId),i=await new _t({apiKey:this.apiKey,projectId:this.projectId,chain:t}).actor.rpcRequest({method:"eth_sendTransaction",params:[{...e,gasLimit:e.gas}]});return{success:!0,chainId:e.chainId,transactionHash:i}}catch(t){return{success:!1,chainId:e.chainId,error:t instanceof Error?t.message:"Unknown error"}}}}class Bs{constructor(e){this.frameSdk=e}async executeChainTransactions(e,t){try{const n=e.split(":")[1];if(!this.isChainSupported(n))throw new Error(`SmartAccount is not supported on chain ID: ${n}`);const i=parseInt(n,10),r=await this.frameSdk.initSmartAccount(i),o=this.formatTransactions(t),c=await r.rpcRequest({method:"wallet_sendCalls",params:[{calls:o}]});return{success:!0,chainId:e,transactionHash:c}}catch(n){return{success:!1,chainId:e,error:n instanceof Error?n.message:"Unknown error"}}}isChainSupported(e){return Object.keys(ie).includes(e)}formatTransactions(e){return e.map(t=>({to:t.to,data:t.data||void 0,value:t.value||void 0}))}}function nt(a){const e=a.filter(n=>n.status==="rejected"||n.status==="fulfilled"&&!n.value.success).map(n=>{var r,o;if(n.status==="rejected")return{chainId:((r=n.reason)==null?void 0:r.chainId)||"Unknown",message:((o=n.reason)==null?void 0:o.message)||"Unknown error"};const i=n;return{chainId:i.value.chainId,message:i.value.error||"Unknown error"}}),t=a.filter(n=>n.status==="fulfilled"&&n.value.success&&!!n.value.transactionHash).map(n=>({chainId:n.value.chainId,transactionHash:n.value.transactionHash}));return{failures:e,successfulHashes:t}}function Ws(a){return a.reduce((e,t)=>(e[t.chainId]||(e[t.chainId]=[]),e[t.chainId].push(t),e),{})}const $s="Bridging transaction failed",Vs="Your transaction seems to be taking longer than usual. Please try resubmitting it from the Dapp",qs="pk_live_B080E9DC31E5875E";class Ks{constructor(e,t){h(this,"apiKey");h(this,"w3mFrame");h(this,"frameSdk");h(this,"transactionExecutor");h(this,"smartAccountExecutor");h(this,"abortController",null);this.projectId=e,this.apiKey=qs,this.w3mFrame=new yt(e),this.frameSdk=t,this.transactionExecutor=new ks(this.apiKey,this.projectId),this.smartAccountExecutor=new Bs(this.frameSdk)}async executeBridgingTransactions(e){const t=await Promise.allSettled(e.map(r=>this.transactionExecutor.executeTransaction(r))),{failures:n,successfulHashes:i}=nt(t);if(n.length>0)throw new Error(JSON.stringify(n));return i}async executeBridgingTransactionsWithSmartAccount(e){const t=Ws(e),n=await Promise.allSettled(Object.entries(t).map(([o,c])=>this.smartAccountExecutor.executeChainTransactions(o,c))),{failures:i,successfulHashes:r}=nt(n);if(i.length>0)throw new Error(JSON.stringify(i));return r}async approveRequest(e,t=[],n){try{S.loading(),this.abortController=new AbortController;const r=await this.frameSdk.shouldUseSmartAccount()?await this.executeBridgingTransactionsWithSmartAccount(t):await this.executeBridgingTransactions(t);return await this.pollBridgingTransactionStatus(n,this.abortController.signal),await this.frameSdk.approveRequest(e),r}catch(i){throw i.name!=="AbortError"&&this.postErrorEvent(e.id,i.message),i}finally{this.finalizeRequest(e)}}postErrorEvent(e,t){this.w3mFrame.events.postFrameEvent({id:e,type:m.FRAME_RPC_REQUEST_ERROR,payload:{message:t}})}finalizeRequest(e){this.abortController=null,[...ve.SAFE_RPC_METHODS,"wallet_getCallsStatus","wallet_getCapabilities"].includes(e.payload.method)||S.close()}async pollBridgingTransactionStatus(e,t,n=10,i=1e3){for(let r=0;r<n;r++){if(t.aborted)throw new Error("Unable to poll bridging transaction status.");const{status:o}=await Gs(e);if(o==="COMPLETED")return;if(o==="ERROR")throw new Error($s);await new Promise(c=>setTimeout(c,i))}throw new Error(Vs)}rejectRequest(e){var t;S.loading(),(t=this.abortController)==null||t.abort(),this.postErrorEvent(e.id,"User rejected"),S.close()}}const zs="_progressBar_rm112_1",Ys="_progressBarFill_rm112_9",st={progressBar:zs,progressBarFill:Ys},Qs=({progress:a})=>s.jsx("div",{className:st.progressBar,children:s.jsx("div",{className:st.progressBarFill,style:{width:`${Math.min(a,100)}%`}})}),it=({label:a,value:e})=>s.jsxs("wui-flex",{gap:"xs",children:[s.jsxs("wui-text",{variant:"small-400",color:"fg-100",align:"center",children:[a,":"]}),s.jsx("wui-text",{variant:"small-400",color:"fg-100",align:"center",children:e})]}),Js="_tokenIconContainer_1thti_1",Zs="_tokenImage_1thti_5",Xs="_chainIcon_1thti_11",Ue={tokenIconContainer:Js,tokenImage:Zs,chainIcon:Xs},rt=({tokenIconUrl:a,chainIconUrl:e})=>s.jsx("div",{className:Ue.tokenIconContainer,children:s.jsxs("wui-flex",{gap:"xs",alignItems:"center",children:[s.jsx("div",{className:Ue.tokenImage,children:s.jsx("wui-image",{src:a,alt:"Token logo"})}),e&&s.jsx("div",{className:Ue.chainIcon,children:s.jsx("wui-image",{src:e,alt:"Chain logo"})})]})});function ei(){return s.jsx("svg",{width:"54",height:"45",viewBox:"0 0 54 45",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:s.jsx("path",{d:"M30.8249 1.59319L52.0448 23.0527M52.0448 23.0527L31.369 43.962M52.0448 23.0527H0.520935",stroke:"#202020",strokeWidth:"3"})})}const ti="_tokenRow_1va1y_1",ai="_arrowContainer_1va1y_10",ot={tokenRow:ti,arrowContainer:ai},ni=({metadata:a,chainImage:e})=>s.jsxs("div",{className:ot.tokenRow,children:[s.jsxs("wui-flex",{justifyContent:"space-between",alignItems:"center",children:[s.jsx(rt,{tokenIconUrl:a.tokenIconUrl,chainIconUrl:a.bridgeSourceChainIcon}),s.jsx("div",{className:ot.arrowContainer,children:s.jsx(ei,{})}),s.jsx(rt,{tokenIconUrl:a.tokenIconUrl,chainIconUrl:e})]}),s.jsx(Qs,{progress:parseFloat(a.bridgeTokenAmount)*100/parseFloat(a.bridgeSourceTokenBalance)}),s.jsxs("wui-flex",{justifyContent:"space-between",alignItems:"center",children:[s.jsx(it,{label:"Balance",value:parseFloat(a.bridgeSourceTokenBalance).toFixed(2)}),s.jsx(it,{label:"Used",value:a.bridgeTokenAmount})]})]});function si({erc20TokenTransferMetadata:a,bridgingTransactionMetadata:e,bridgingTransactions:t,orchestrationId:n,frameSdk:i}){const r=R.state.projectId,{event:o,loading:c}=x(S.state),{chainImage:l,chainName:d}=x(A.state),{metadata:u,verified:f}=x(R.state),p=e.reduce((w,I)=>{const{tokenSymbol:v,bridgeTokenAmount:C,tokenIconUrl:T}=I;return w[v]||(w[v]={totalAmount:0,tokenIconUrl:T}),w[v].totalAmount+=parseFloat(C),w},{});async function y(){if(!r)throw new Error("Project ID not found");if(!i)throw new Error("Frame SDK not found");new Ks(r,i).approveRequest(o,t,n)}async function E(){i==null||i.rejectRequest(o)}return s.jsxs("wui-flex",{flexDirection:"column",alignItems:"center",padding:["xl","0","m","0"],gap:"l",flexGrow:"1",children:[s.jsx(g,{flexDirection:"column",alignItems:"center",children:s.jsx("wui-visual-thumbnail",{imageSrc:u==null?void 0:u.icons[0],borderRadiusFull:!0})}),s.jsx(g,{flexDirection:"column",alignItems:"center",children:s.jsxs("wui-text",{variant:"paragraph-500",color:"fg-100",align:"center",children:[u==null?void 0:u.name," requests a transaction"]})}),s.jsx(g,{flexDirection:"column",padding:["l","0","0","0"],alignItems:"center",children:s.jsx("wui-chip",{icon:f?"verifyFilled":"warningCircle",variant:f?"success":"error",href:u==null?void 0:u.url})}),s.jsx(g,{flexDirection:"column",alignItems:"center",children:s.jsx("wui-text",{variant:"paragraph-700",color:"fg-100",align:"center",children:"Transaction Request"})}),s.jsx("wui-details-group",{children:s.jsx(g,{flexDirection:"column",padding:["xs","0","0","0"],alignItems:"center",width:"100%",children:s.jsxs("wui-flex",{justifyContent:"space-between",alignItems:"center",children:[s.jsx("wui-text",{variant:"paragraph-500",color:"fg-100",align:"center",children:"Transfer Amount"}),s.jsxs("wui-text",{variant:"paragraph-500",color:"fg-100",align:"center",children:[a.amount," ",a.assetSymbol]})]})})}),s.jsx(g,{flexDirection:"column",padding:["xs","0","0","0"],alignItems:"center",width:"100%",children:s.jsx("wui-list-content",{textTitle:d,imageSrc:l})}),s.jsxs("wui-details-group",{children:[s.jsx(g,{flexDirection:"column",padding:["xs","0","0","0"],alignItems:"center",width:"100%",children:s.jsxs("wui-flex",{justifyContent:"space-between",alignItems:"center",children:[s.jsx("wui-text",{variant:"paragraph-500",color:"fg-100",align:"center",children:"Bridge Funds"}),s.jsxs("wui-text",{variant:"paragraph-500",color:"fg-100",align:"center",children:[Object.values(p)[0].totalAmount," ",Object.keys(p)[0]]})]})}),s.jsx(g,{flexDirection:"column",alignItems:"center",children:s.jsx("wui-text",{variant:"small-400",color:"fg-200",align:"center",children:`You dont have funds on ${d} but you have funds on other networks. You can use these.`})}),e.map((w,I)=>s.jsx(ni,{metadata:w,chainImage:l},I)),s.jsx(g,{flexDirection:"column",padding:["xl","0","0","0"],alignItems:"center",children:s.jsx("wui-text",{variant:"small-400",color:"fg-200",align:"center",children:"Review transaction carefully"})})]}),s.jsx("div",{className:"signWrapper",children:c?s.jsxs(s.Fragment,{children:[s.jsx("wui-button",{fullWidth:!0,disabled:!0,size:"lg",borderRadius:"xs",variant:"neutral",children:"Cancel"}),s.jsx("wui-button",{fullWidth:!0,disabled:!0,loading:!0,size:"lg",borderRadius:"xs",variant:"main",children:"Sign"})]}):s.jsxs(s.Fragment,{children:[s.jsx("wui-button",{fullWidth:!0,size:"lg",borderRadius:"xs",variant:"neutral",onClick:E,children:"Cancel"}),s.jsx("wui-button",{fullWidth:!0,size:"lg",borderRadius:"xs",variant:"main",onClick:y,children:"Approve"})]})})]})}const ii={USDC:{[ce.id]:"0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913",[dt.id]:"0x0b2c639c533813f4aa9d7837caf62653d097ff85",[oe.id]:"0xaf88d065e77c8cC2239327C5EDb3A432268e5831"}},ri={USDC:6};function oi({data:a,from:e,to:t}){const{functionName:n,args:i}=ln({abi:Tt,data:a});return n!=="transfer"?null:{to:i[0],contract:t,amount:Number(i[1]),from:e}}function ci(a){for(const[e,t]of Object.entries(ii))for(const n of Object.values(t))if(n.toLowerCase()===a.toLowerCase())return e;throw new Error("Asset not found for the given contract address")}function li(a,e){const t=ri[a];if(!t)throw new Error("Asset not supported");return e/10**t}const di=(a,e)=>{const t=parseInt(a,16),n=parseInt(e);return(t/10**n).toFixed(3)},ui=async({fundingFrom:a,from:e,projectId:t})=>{const n=a.map(async i=>{const{chainId:r,tokenContract:o,amount:c}=i;if(!r||!o)return null;try{const[l,d]=await Promise.all([Ge.fetchNetworkImage(At.EIP155NetworkImageIds[r]??1,t||""),U.getBalance(e,r)]),u=d.balances.find(f=>{var p,y;return((y=(p=f.address)==null?void 0:p.split(":")[2])==null?void 0:y.toLowerCase())===o.toLowerCase()});return u?{tokenAddress:o,tokenIconUrl:u.iconUrl,tokenDecimal:u.quantity.decimals,tokenSymbol:u.symbol,bridgeTokenAmount:di(c,u.quantity.decimals),bridgeSourceTokenBalance:parseFloat(u.quantity.numeric).toFixed(3),bridgeSourceChainId:r,bridgeSourceChainName:"",bridgeSourceChainIcon:l||""}:null}catch(l){return console.error(`Error processing metadata for chainId ${r}:`,l),null}});return(await Promise.all(n)).filter(i=>i!==null)},pi="0x095ea7b3";function hi({frameSdk:a}){var $e,Ve,qe;const{event:e,loading:t}=x(S.state),n=R.state.projectId||"",{chainId:i}=x(A.state),[r,o]=$.useState(!1),[c,l]=$.useState([]),[d,u]=$.useState(),[f,p]=$.useState([]),[y,E]=$.useState(),w=$.useRef(!1);if((($e=e==null?void 0:e.payload)==null?void 0:$e.method)!=="eth_sendTransaction")return null;const I=((qe=(Ve=e==null?void 0:e.payload)==null?void 0:Ve.params)==null?void 0:qe[0])||{},{to:v,data:C,from:T,value:K}=I,ae=C==null?void 0:C.startsWith(pi),We=$.useCallback(async()=>{try{const B=await Ls({from:T,to:v,value:K||"0",gas:"0",gasPrice:"0",data:C,nonce:"0",maxFeePerGas:"0",maxPriorityFeePerGas:"0",chainId:i});if("error"in B){console.error("Error during finding transaction route:",B.error),a==null||a.errorRequest(e,B.error);return}if(B.transactions.length>0){const ne=oi({data:C,from:T,to:v});if(ne){const Ke=ci(ne.contract),Bt={amount:li(Ke,ne.amount),assetSymbol:Ke,from:ne.from,to:ne.to},Wt=B.metadata.fundingFrom,$t=await ui({fundingFrom:Wt,from:T,projectId:n});E(Bt),p($t),l(B.transactions),u(B.orchestrationId)}}o(!0)}catch(B){console.error("Failed to find transaction route:",B),o(!0)}},[T,v,K,C,i]);return $.useEffect(()=>{!ae&&!r&&!w.current&&(w.current=!0,We())},[ae,r,We]),r?c.length>0&&d&&f&&y?s.jsx(si,{erc20TokenTransferMetadata:y,bridgingTransactionMetadata:f,bridgingTransactions:c,orchestrationId:d,frameSdk:a}):s.jsxs("wui-flex",{flexDirection:"column",alignItems:"center",padding:["xl","0","m","0"],gap:"l",flexGrow:"1",children:[ae?s.jsx(Fs,{}):s.jsx(Hs,{}),s.jsx("div",{className:"signWrapper",children:t?s.jsxs(s.Fragment,{children:[s.jsx("wui-button",{fullWidth:!0,disabled:!0,size:"lg",borderRadius:"xs",variant:"neutral",children:"Cancel"}),s.jsx("wui-button",{fullWidth:!0,disabled:!0,loading:!0,size:"lg",borderRadius:"xs",variant:"main",children:"Sign"})]}):s.jsxs(s.Fragment,{children:[s.jsx("wui-button",{fullWidth:!0,size:"lg",borderRadius:"xs",variant:"neutral",onClick:()=>a==null?void 0:a.rejectRequest(e),children:"Cancel"}),s.jsx("wui-button",{fullWidth:!0,size:"lg",borderRadius:"xs",variant:"main",onClick:()=>a==null?void 0:a.approveRequest(e),children:"Approve"})]})})]}):s.jsx("wui-loading-spinner",{})}function mi(){var d,u,f;const{event:a}=x(S.state),{chainImage:e,chainName:t,chainExplorerURL:n}=x(A.state),{metadata:i,verified:r}=x(R.state);if(((d=a==null?void 0:a.payload)==null?void 0:d.method)!=="wallet_sendCalls")return null;const{calls:o,from:c}=((f=(u=a==null?void 0:a.payload)==null?void 0:u.params)==null?void 0:f[0])||{},l=`${n}/address/${c}`;return s.jsxs(s.Fragment,{children:[s.jsx(g,{flexDirection:"column",alignItems:"center",children:s.jsx("wui-visual-thumbnail",{imageSrc:i==null?void 0:i.icons[0],borderRadiusFull:!0})}),s.jsx(g,{flexDirection:"column",alignItems:"center",children:s.jsxs("wui-text",{variant:"paragraph-500",color:"fg-100",align:"center",children:[i==null?void 0:i.name," requests multiple transactions"]})}),s.jsx(g,{flexDirection:"column",padding:["m","6xl","0","6xl"],alignItems:"center",children:s.jsx("wui-text",{variant:"small-400",color:"fg-200",align:"center",children:"Accept all transactions to prove you own this wallet and to continue"})}),s.jsx(g,{flexDirection:"column",padding:["l","0","0","0"],alignItems:"center",children:s.jsx("wui-chip",{icon:r?"verifyFilled":"warningCircle",variant:r?"success":"error",href:i==null?void 0:i.url})}),!r&&s.jsx(g,{flexDirection:"column",padding:["xs","0","0","0"],alignItems:"center",children:s.jsx("wui-text",{variant:"small-400",color:"error-100",align:"center",children:"This domain cannot be verified. Check the request carefully before approving."})}),s.jsx(g,{flexDirection:"column",padding:["xxl","0","0","0"],alignItems:"center",width:"100%",children:s.jsx("wui-list-content",{textTitle:t,imageSrc:e})}),o.map(p=>s.jsxs(s.Fragment,{children:[p.value?s.jsx(g,{flexDirection:"column",padding:["xs","0","0","0"],alignItems:"center",width:"100%",children:s.jsx("wui-list-wallet-transaction",{amount:mt(Q(p.value,"bigint")),networkImageUrl:e,addressExplorerUrl:l,receiverAddress:Me.getTruncateString({string:p.to,truncate:"middle",charsStart:4,charsEnd:4})})}):null,null,p.data&&p.data!=="0x"?s.jsx(g,{flexDirection:"column",padding:["xs","0","0","0"],alignItems:"center",width:"100%",children:s.jsx("wui-list-accordion",{textTitle:"Call data",overflowedContent:p.data})}):null]})),s.jsx(g,{flexDirection:"column",padding:["xl","0","0","0"],alignItems:"center",children:s.jsx("wui-text",{variant:"small-400",color:"fg-200",align:"center",children:"Review transactions carefully"})})]})}function gi({frameSdk:a}){var i,r;const{open:e,event:t,loading:n}=x(S.state);return!e||((i=t==null?void 0:t.payload)==null?void 0:i.method)!=="wallet_sendCalls"||!((r=t==null?void 0:t.payload)!=null&&r.params)?null:s.jsxs("wui-flex",{flexDirection:"column",alignItems:"center",padding:["xl","0","m","0"],gap:"l",children:[s.jsx(mi,{}),s.jsx("div",{className:"signWrapper",children:n?s.jsxs(s.Fragment,{children:[s.jsx("wui-button",{fullWidth:!0,disabled:!0,size:"lg",borderRadius:"xs",variant:"neutral",children:"Cancel"}),s.jsx("wui-button",{fullWidth:!0,disabled:!0,loading:!0,size:"lg",borderRadius:"xs",variant:"main",children:"Sign"})]}):s.jsxs(s.Fragment,{children:[s.jsx("wui-button",{fullWidth:!0,size:"lg",borderRadius:"xs",variant:"neutral",onClick:()=>a==null?void 0:a.rejectRequest(t),children:"Cancel"}),s.jsx("wui-button",{fullWidth:!0,size:"lg",borderRadius:"xs",variant:"main",onClick:()=>a==null?void 0:a.approveRequest(t),children:"Approve"})]})})]})}function fi({frameSdk:a}){var I;const{event:e,loading:t}=x(S.state),{chainImage:n,chainName:i}=x(A.state),{metadata:r,verified:o}=x(R.state);if(((I=e==null?void 0:e.payload)==null?void 0:I.method)!=="wallet_grantPermissions")return null;const l=(()=>{var v;try{const C=e==null?void 0:e.payload;return(v=C==null?void 0:C.params)==null?void 0:v[0]}catch{return"Could not parse permissions"}})(),{permissions:d,address:u,expiry:f}=l,p=d[0],{data:y}=p,{address:E,functions:w}=y;return s.jsxs(g,{flexDirection:"column",padding:["0","m","0","m"],alignItems:"center",children:[s.jsx(g,{flexDirection:"column",padding:["5xxl","0","0","0"],alignItems:"center",children:s.jsx("wui-visual-thumbnail",{imageSrc:r==null?void 0:r.icons[0],borderRadiusFull:!0})}),s.jsx(g,{flexDirection:"column",padding:["xxl","xl","0","xl"],alignItems:"center",children:s.jsxs("wui-text",{variant:"paragraph-500",color:"fg-100",align:"center",children:[r==null?void 0:r.name," requests permissions"]})}),s.jsx(g,{flexDirection:"column",padding:["m","6xl","0","6xl"],alignItems:"center",children:s.jsxs("wui-text",{variant:"small-400",color:"fg-200",align:"center",children:["Approve request to grant permissions to ",r==null?void 0:r.name]})}),s.jsx(g,{flexDirection:"column",padding:["l","0","0","0"],alignItems:"center",children:s.jsx("wui-chip",{icon:o?"verifyFilled":"warningCircle",variant:o?"success":"error",href:r==null?void 0:r.url})}),!o&&s.jsx(g,{flexDirection:"column",padding:["xs","0","0","0"],alignItems:"center",children:s.jsx("wui-text",{variant:"small-400",color:"error-100",align:"center",children:"This domain cannot be verified. Check the request carefully before approving."})}),s.jsx("wui-permission-contract-call",{contractAddress:E,expiry:f,functions:JSON.stringify(w)}),s.jsx(g,{flexDirection:"column",padding:["l","0","0","0"],alignItems:"center",width:"100%",children:s.jsx("wui-details-group",{children:s.jsxs(g,{justifyContent:"space-between",width:"100%",children:[s.jsxs("wui-flex",{flexDirection:"column",children:[s.jsx("wui-text",{variant:"paragraph-400",color:"fg-300",children:"Creating with"}),s.jsx("wui-text",{variant:"small-600",color:"fg-100",children:H.getTruncateString({string:u,truncate:"middle",charsStart:4,charsEnd:4})})]}),s.jsxs("wui-flex",{flexDirection:"column",alignItems:"flex-end",children:[s.jsx("wui-text",{variant:"paragraph-400",color:"fg-300",children:"Network"}),s.jsxs("wui-flex",{alignItems:"center",gap:"xxs",children:[s.jsx("div",{style:{borderRadius:"50%",overflow:"hidden"},children:s.jsx("wui-image",{size:"lg",src:n,alt:"Token logo"})}),s.jsx("wui-text",{variant:"small-600",color:"fg-100",children:i})]})]})]})})}),s.jsx("div",{className:"signWrapper",children:t?s.jsxs(s.Fragment,{children:[s.jsx("wui-button",{fullWidth:!0,disabled:!0,size:"lg",borderRadius:"xs",variant:"neutral",children:"Cancel"}),s.jsx("wui-button",{fullWidth:!0,disabled:!0,loading:!0,size:"lg",borderRadius:"xs",variant:"main",children:"Approve"})]}):s.jsxs(s.Fragment,{children:[s.jsx("wui-button",{fullWidth:!0,size:"lg",borderRadius:"xs",variant:"neutral",onClick:()=>a==null?void 0:a.rejectRequest(e),children:"Cancel"}),s.jsx("wui-button",{fullWidth:!0,size:"lg",borderRadius:"xs",variant:"main",onClick:()=>a==null?void 0:a.approveRequest(e),children:"Approve"})]})})]})}function yi({frameSdk:a}){var I;const{event:e,loading:t}=x(S.state),{chainImage:n,chainName:i}=x(A.state),{metadata:r,verified:o}=x(R.state);if(((I=e==null?void 0:e.payload)==null?void 0:I.method)!=="wallet_revokePermissions")return null;const l=(()=>{var v;try{const C=e==null?void 0:e.payload;return(v=C==null?void 0:C.params)==null?void 0:v[0]}catch{return"Could not parse permissions"}})(),{permissions:d,address:u,expiry:f}=l,p=d[0],{data:y}=p,{address:E,functions:w}=y;return s.jsxs(g,{flexDirection:"column",padding:["0","m","0","m"],alignItems:"center",children:[s.jsx(g,{flexDirection:"column",padding:["5xxl","0","0","0"],alignItems:"center",children:s.jsx("wui-visual-thumbnail",{imageSrc:r==null?void 0:r.icons[0],borderRadiusFull:!0})}),s.jsx(g,{flexDirection:"column",padding:["xxl","xl","0","xl"],alignItems:"center",children:s.jsxs("wui-text",{variant:"paragraph-500",color:"fg-100",align:"center",children:[r==null?void 0:r.name," wants to revoke permissions"]})}),s.jsx(g,{flexDirection:"column",padding:["m","6xl","0","6xl"],alignItems:"center",children:s.jsxs("wui-text",{variant:"small-400",color:"fg-200",align:"center",children:["Approve request to revoke permissions to ",r==null?void 0:r.name]})}),s.jsx(g,{flexDirection:"column",padding:["l","0","0","0"],alignItems:"center",children:s.jsx("wui-chip",{icon:o?"verifyFilled":"warningCircle",variant:o?"success":"error",href:r==null?void 0:r.url})}),!o&&s.jsx(g,{flexDirection:"column",padding:["xs","0","0","0"],alignItems:"center",children:s.jsx("wui-text",{variant:"small-400",color:"error-100",align:"center",children:"This domain cannot be verified. Check the request carefully before approving."})}),s.jsx("wui-permission-contract-call",{contractAddress:E,expiry:f,functions:JSON.stringify(w)}),s.jsx(g,{flexDirection:"column",padding:["l","0","0","0"],alignItems:"center",width:"100%",children:s.jsx("wui-details-group",{children:s.jsxs(g,{justifyContent:"space-between",width:"100%",children:[s.jsxs("wui-flex",{flexDirection:"column",children:[s.jsx("wui-text",{variant:"paragraph-400",color:"fg-300",children:"Creating with"}),s.jsx("wui-text",{variant:"small-600",color:"fg-100",children:H.getTruncateString({string:u,truncate:"middle",charsStart:4,charsEnd:4})})]}),s.jsxs("wui-flex",{flexDirection:"column",alignItems:"flex-end",children:[s.jsx("wui-text",{variant:"paragraph-400",color:"fg-300",children:"Network"}),s.jsxs("wui-flex",{alignItems:"center",gap:"xxs",children:[s.jsx("div",{style:{borderRadius:"50%",overflow:"hidden"},children:s.jsx("wui-image",{size:"lg",src:n,alt:"Token logo"})}),s.jsx("wui-text",{variant:"small-600",color:"fg-100",children:i})]})]})]})})}),s.jsx("div",{className:"signWrapper",children:t?s.jsxs(s.Fragment,{children:[s.jsx("wui-button",{fullWidth:!0,disabled:!0,size:"lg",borderRadius:"xs",variant:"neutral",children:"Cancel"}),s.jsx("wui-button",{fullWidth:!0,disabled:!0,loading:!0,size:"lg",borderRadius:"xs",variant:"main",children:"Approve"})]}):s.jsxs(s.Fragment,{children:[s.jsx("wui-button",{fullWidth:!0,size:"lg",borderRadius:"xs",variant:"neutral",onClick:()=>a==null?void 0:a.rejectRequest(e),children:"Cancel"}),s.jsx("wui-button",{fullWidth:!0,size:"lg",borderRadius:"xs",variant:"main",onClick:()=>a==null?void 0:a.approveRequest(e),children:"Approve"})]})})]})}function xi({frameSdk:a}){const{event:e,loading:t}=x(S.state),{chainImage:n,chainName:i}=x(A.state),{metadata:r,verified:o}=x(R.state),c=vi(e);return!c||!e?null:s.jsxs("wui-flex",{flexDirection:"column",alignItems:"center",padding:["xl","0","m","0"],gap:"l",flexGrow:"1",children:[s.jsx(g,{flexDirection:"column",alignItems:"center",children:s.jsx("wui-visual-thumbnail",{imageSrc:r==null?void 0:r.icons[0],borderRadiusFull:!0})}),s.jsx(g,{flexDirection:"column",alignItems:"center",children:s.jsxs("wui-text",{variant:"paragraph-500",color:"fg-100",align:"center",children:[r==null?void 0:r.name," ",c.requesting]})}),s.jsx(g,{flexDirection:"column",padding:["m","6xl","0","6xl"],alignItems:"center",children:s.jsx("wui-text",{variant:"small-400",color:"fg-200",align:"center",children:c.message})}),s.jsx(g,{flexDirection:"column",padding:["l","0","0","0"],alignItems:"center",children:s.jsx("wui-chip",{icon:o?"verifyFilled":"warningCircle",variant:o?"success":"error",href:r==null?void 0:r.url})}),s.jsx(g,{flexDirection:"column",padding:["xxl","0","0","0"],alignItems:"center",width:"100%",children:s.jsx("wui-list-content",{textTitle:i,imageSrc:n})}),s.jsx(g,{flexDirection:"column",padding:["xs","0","0","0"],alignItems:"center",width:"100%",gap:"xs",children:s.jsx(wi,{transaction:c.transaction})}),s.jsxs("div",{className:"signWrapper",children:[s.jsx("wui-button",{fullWidth:!0,size:"lg",borderRadius:"xs",variant:"neutral",onClick:()=>a==null?void 0:a.rejectRequest(e),children:"Cancel"}),s.jsx("wui-button",{fullWidth:!0,size:"lg",loading:t?!0:void 0,borderRadius:"xs",variant:"main",onClick:()=>a==null?void 0:a.approveRequest(e),children:c.confirmButton})]})]})}function wi(a){return(Array.isArray(a.transaction)?a.transaction:[a.transaction]).map(t=>t?s.jsxs("wui-details-group",{children:[s.jsx("wui-details-group-item",{name:"Version",children:s.jsx("wui-text",{variant:"small-400",color:"fg-100",children:t.version})}),t.instructions.map(n=>s.jsxs(s.Fragment,{children:[s.jsx("wui-details-group-item",{name:"Program ID",children:s.jsx("wui-chip",{href:n.programExplorerUrl,title:n.programId,variant:"transparent"})}),s.jsx("wui-list-accordion",{textTitle:"Data",overflowedContent:n.data})]}))]}):s.jsx("wui-text",{variant:"small-400",color:"fg-200",children:"It was not possible to parse transaction data"}))}const Ei=a=>{const e=A.state.chainExplorerURL||"https://explorer.solana.com",[t,n=""]=e.split("?");return`${t}/address/${a}?${n}`},Fe=a=>{try{const e=ye.deserialize(k.decode(a));return{version:e.version,instructions:e.message.compiledInstructions.map(t=>{const n=e.message.staticAccountKeys[t.programIdIndex].toBase58();return{programId:H.getTruncateString({string:n,charsStart:4,charsEnd:4,truncate:"middle"}),data:k.encode(t.data),programExplorerUrl:Ei(n)}})}}catch{return null}},vi=a=>{switch(a==null?void 0:a.payload.method){case"solana_signTransaction":return{requesting:"requests to sign a transaction",transaction:Fe(a.payload.params.transaction),confirmButton:"Sign",message:"By confirming the transaction will be signed by your wallet and returned to the application"};case"solana_signAndSendTransaction":return{requesting:"requests to sign and send a transaction",transaction:Fe(a.payload.params.transaction),confirmButton:"Sign and Send",message:"By confirming the transaction will be signed and sent by your wallet"};case"solana_signAllTransactions":return{requesting:"requests to sign all transactions",confirmButton:"Sign All",message:"By confirming all transactions will be signed by your wallet and returned to the application",transaction:a.payload.params.transactions.map(Fe)};default:return null}};let ct=null;if(typeof window<"u"&&(mn(),ct=new URLSearchParams(window==null?void 0:window.location.search).get("error"),!ct)){const a=new URLSearchParams(window==null?void 0:window.location.search),e=a.get("projectId"),t=a.get("chainId")??void 0,n=a.get("version"),i=n&&!isNaN(Number(n))?Number(n):1;if(e)Le.setFrameSdk(new Es(e,t,i));else if(!window.location.pathname.includes("/oauth"))throw new Error("Missing projectId in AppKitProvider")}function Ci(){const{themeVariables:a,themeMode:e,w3mThemeVariables:t}=x(It.state),{frameSdk:n}=x(Le.state),{open:i}=x(S.state);return b.useEffect(()=>{e&&gn(e)},[e]),b.useEffect(()=>{a&&fn(a)},[a]),b.useEffect(()=>{const r=t==null?void 0:t["--w3m-background"],o=t==null?void 0:t["--w3m-accent"];r&&o&&typeof document<"u"&&(document.documentElement.style.setProperty("--wui-color-modal-bg-base",r),document.documentElement.style.setProperty("--wui-color-accent-base-100",o))},[t,typeof document]),i?s.jsxs(s.Fragment,{children:[s.jsx(Is,{frameSdk:n}),s.jsx(Ss,{frameSdk:n}),s.jsx(hi,{frameSdk:n}),s.jsx(gi,{frameSdk:n}),s.jsx(fi,{frameSdk:n}),s.jsx(yi,{frameSdk:n}),s.jsx(xi,{frameSdk:n})]}):s.jsx(g,{width:"100%",flexDirection:"column",alignItems:"center",justifyContent:"center",children:s.jsx("wui-loading-spinner",{size:"xl"})})}function Ii(a){const e="https://secure.walletconnect.com/sdk",t=new URL(e);return new URLSearchParams(a).forEach((n,i)=>{t.searchParams.append(i,n)}),t.toString()}function Si(){const a=Ii(window.location.search);return s.jsx(s.Fragment,{children:s.jsx("iframe",{id:"frame-mobile-sdk",title:"frame-mobile-sdk",style:{position:"fixed",zIndex:"999999",width:"100%",height:"100%",padding:0,margin:0,border:0,top:0,bottom:0,left:0,right:0},src:a})})}const Ai="_Tag_1dmib_1",bi={Tag:Ai};function _i({children:a}){return s.jsx(g,{justifyContent:"center",alignItems:"center",className:bi.Tag,children:a})}const Ri="_text_13itb_1",ji={text:Ri};function fe({variant:a,children:e,as:t,color:n,href:i,id:r,target:o,rel:c,className:l=""}){return b.createElement(t||"p",{children:e,href:i,target:o,rel:c,className:`${ji.text} ${l}`,id:r,style:{color:n==="inherit"?"inherit":`var(--color-${n})`},"data-variant":a})}function Ti({width:a=32,height:e=32}){return s.jsxs("svg",{width:a,height:e,viewBox:`0 0 ${a} ${e}`,fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[s.jsx("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M21.8798 11.3296C22.2502 11.6401 22.2987 12.192 21.988 12.5623L15.2762 20.5623C15.1186 20.7501 14.8896 20.8632 14.6447 20.8741C14.3998 20.8851 14.1615 20.7929 13.9878 20.6199L10.0662 16.7147C9.72368 16.3737 9.7226 15.8197 10.0638 15.4773C10.4049 15.1349 10.9591 15.1339 11.3016 15.4749L14.5477 18.7073L20.6467 11.4377C20.9574 11.0675 21.5094 11.0191 21.8798 11.3296Z",fill:"#26D962"}),s.jsx("circle",{opacity:"0.1",cx:a/2,cy:e/2,r:a/2,fill:"#26D962"})]})}const Ui="_header_1nmdw_1",Fi={header:Ui};function Pi({children:a}){return s.jsx("header",{className:Fi.header,children:a})}function Di(){const[a,e]=b.useState(!1),t=()=>{setInterval(()=>{const n=N.createResultUri(window.location.href);window.opener.postMessage({resultUri:n},"*")},1e3)};return b.useEffect(()=>{e(!0),t()},[]),s.jsxs(s.Fragment,{children:[s.jsx(Pi,{children:s.jsx("a",{href:"/dashboard",children:s.jsxs(g,{gap:"xxs",alignItems:"center",children:[s.jsx(fe,{variant:"h3",color:"inverse-100",children:"WalletConnect"}),s.jsx(_i,{children:"Secure"})]})})}),s.jsx("div",{className:"oauth",children:a?s.jsxs(s.Fragment,{children:[s.jsx(fe,{variant:"h3",color:"grey-80",children:"Successfully logged in"}),s.jsx(fe,{variant:"h4",color:"grey-80",children:"Return to the application, do not close this tab"}),s.jsx(Ti,{})]}):s.jsx(s.Fragment,{children:s.jsx(fe,{variant:"h3",color:"grey-80",children:"Loading..."})})})]})}function Ni(){const[a,e]=b.useState({name:null,verified:null,host:null});return b.useEffect(()=>{async function t(){const n=new URLSearchParams(window.location.search).get("projectId")||"";try{const i=new URLSearchParams({projectId:n,referer:document.referrer}),o=await(await fetch(`/get-dapp-data?${i.toString()}`)).json();e(o),R.setVerified(o.verified)}catch(i){console.error("Failed to fetch Dapp data:",i)}}t()},[]),s.jsx("html",{lang:"en","data-dapp-name":a.name,"data-dapp-verified":a.verified,"data-dapp-host":a.host,children:s.jsx("body",{children:s.jsx(na,{children:s.jsxs(sa,{children:[s.jsx(de,{path:"/sdk",element:s.jsx(Ci,{})}),s.jsx(de,{path:"/sdk/oauth",element:s.jsx(Di,{})}),s.jsx(de,{path:"/mobile-sdk",element:s.jsx(Si,{})}),s.jsx(de,{path:"*",element:s.jsx(Pn,{})})]})})})})}const Oi=document.getElementById("root"),Mi=ia.createRoot(Oi);Mi.render(s.jsx($.StrictMode,{children:s.jsx(Ni,{})}));
